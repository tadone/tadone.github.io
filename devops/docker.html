<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Docker | Tadone Vuepress</title>
    <meta name="description" content="Tadone Vuepress">
    <link rel="icon" href="/logo.png">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <link rel="apple-touch-icon" href="/icons/apple-touch-icon-152x152.png">
  <link rel="mask-icon" href="/icons/safari-pinned-tab.svg" color="#3eaf7c">
  <meta name="msapplication-TileImage" content="/icons/msapplication-icon-144x144.png">
  <meta name="msapplication-TileColor" content="#000000">
    
    <link rel="preload" href="/assets/css/styles.8ced4ed7.css" as="style"><link rel="preload" href="/assets/js/app.8ced4ed7.js" as="script"><link rel="preload" href="/assets/js/14.f59d9620.js" as="script"><link rel="prefetch" href="/assets/js/15.2ea851e2.js"><link rel="prefetch" href="/assets/css/1.styles.b381e534.css"><link rel="prefetch" href="/assets/js/1.b381e534.js"><link rel="prefetch" href="/assets/css/2.styles.117645b2.css"><link rel="prefetch" href="/assets/js/2.117645b2.js"><link rel="prefetch" href="/assets/js/3.782202b1.js"><link rel="prefetch" href="/assets/js/4.a6a5d4e3.js"><link rel="prefetch" href="/assets/js/5.6f82863a.js"><link rel="prefetch" href="/assets/js/6.655e6998.js"><link rel="prefetch" href="/assets/js/7.006efceb.js"><link rel="prefetch" href="/assets/js/8.b332af39.js"><link rel="prefetch" href="/assets/js/9.772e9d0c.js"><link rel="prefetch" href="/assets/js/10.81170a9d.js"><link rel="prefetch" href="/assets/js/11.f3b63aa3.js"><link rel="prefetch" href="/assets/js/12.1db942a0.js"><link rel="prefetch" href="/assets/js/13.39221676.js"><link rel="prefetch" href="/assets/js/16.c9fc3453.js"><link rel="prefetch" href="/assets/js/17.a0509b86.js"><link rel="prefetch" href="/assets/js/18.de168fff.js"><link rel="prefetch" href="/assets/js/19.0a4ac3e1.js"><link rel="prefetch" href="/assets/js/20.b1738c0d.js"><link rel="prefetch" href="/assets/js/21.5442c8ed.js"><link rel="prefetch" href="/assets/js/22.3de5c086.js"><link rel="prefetch" href="/assets/js/23.8cc78002.js"><link rel="prefetch" href="/assets/js/24.4f4b0bdc.js"><link rel="prefetch" href="/assets/js/25.19e77aa6.js"><link rel="prefetch" href="/assets/js/26.ef76cd52.js"><link rel="prefetch" href="/assets/js/27.4e2d44e6.js"><link rel="prefetch" href="/assets/js/28.0193cd38.js"><link rel="prefetch" href="/assets/js/29.ca40e9b4.js"><link rel="prefetch" href="/assets/js/30.5471b40e.js"><link rel="prefetch" href="/assets/js/31.d7bc4934.js"><link rel="prefetch" href="/assets/js/32.89422ce1.js"><link rel="prefetch" href="/assets/js/33.01f0c270.js"><link rel="prefetch" href="/assets/js/34.60b489eb.js">
    <link rel="stylesheet" href="/assets/css/1.styles.b381e534.css"><link rel="stylesheet" href="/assets/css/2.styles.117645b2.css"><link rel="stylesheet" href="/assets/css/styles.8ced4ed7.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Tadone Vuepress</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">Home</a></div><div class="nav-item"><a href="https://github.com/tadone" target="_blank" rel="noopener noreferrer" class="nav-link external">
  My GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">Home</a></div><div class="nav-item"><a href="https://github.com/tadone" target="_blank" rel="noopener noreferrer" class="nav-link external">
  My GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><div class="sidebar-group first"><p class="sidebar-heading"><span>Cloud</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/cloud/aws.html" class="sidebar-link">AWS</a></li><li><a href="/cloud/azure.html" class="sidebar-link">Azure</a></li></ul></div></li><li><div class="sidebar-group"><p class="sidebar-heading"><span>Code</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/code/git.html" class="sidebar-link">Git</a></li><li><a href="/code/bash.html" class="sidebar-link">Bash Scripting</a></li><li><a href="/code/python.html" class="sidebar-link">Python</a></li><li><a href="/code/python/list.html" class="sidebar-link">Python Lists</a></li><li><a href="/code/python/class.html" class="sidebar-link">Python Classes</a></li></ul></div></li><li><div class="sidebar-group"><p class="sidebar-heading open"><span>DevOps</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/devops/cicd.html" class="sidebar-link">CI/CD</a></li><li><a href="/devops/docker.html" class="active sidebar-link">Docker</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/devops/docker.html#dockerfile" class="sidebar-link">Dockerfile</a></li><li class="sidebar-sub-header"><a href="/devops/docker.html#build-push" class="sidebar-link">Build &amp; Push</a></li><li class="sidebar-sub-header"><a href="/devops/docker.html#run" class="sidebar-link">Run</a></li><li class="sidebar-sub-header"><a href="/devops/docker.html#manage" class="sidebar-link">Manage</a></li><li class="sidebar-sub-header"><a href="/devops/docker.html#system" class="sidebar-link">System</a></li><li class="sidebar-sub-header"><a href="/devops/docker.html#docker-compose" class="sidebar-link">Docker-Compose</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/devops/docker.html#logs" class="sidebar-link">Logs</a></li></ul></li><li class="sidebar-sub-header"><a href="/devops/docker.html#tips-tricks" class="sidebar-link">Tips &amp; Tricks</a></li></ul></li><li><a href="/devops/databases.html" class="sidebar-link">Database Technologies</a></li><li><a href="/devops/sql.html" class="sidebar-link">SQL Basics</a></li></ul></div></li><li><div class="sidebar-group"><p class="sidebar-heading"><span>Kubernetes</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/kubernetes/overview.html" class="sidebar-link">Overview</a></li><li><a href="/kubernetes/kubectl.html" class="sidebar-link">KubeCtl</a></li><li><a href="/kubernetes/objects.html" class="sidebar-link">Objects</a></li><li><a href="/kubernetes/ingress.html" class="sidebar-link">Services &amp; Ingress</a></li><li><a href="/kubernetes/minikube.html" class="sidebar-link">Minikube</a></li><li><a href="/kubernetes/own_cluster.html" class="sidebar-link">Own Cluster</a></li><li><a href="/kubernetes/extras.html" class="sidebar-link">Pod Options</a></li><li><a href="/kubernetes/yaml.html" class="sidebar-link">YAML Explained</a></li></ul></div></li><li><div class="sidebar-group"><p class="sidebar-heading"><span>Linux</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/linux/bash_shell.html" class="sidebar-link">Bash Shell</a></li><li><a href="/linux/linux_basics.html" class="sidebar-link">Fundementals</a></li><li><a href="/linux/linux_metrics.html" class="sidebar-link">Metrics</a></li><li><a href="/linux/linux_tools.html" class="sidebar-link">GNU Tools</a></li></ul></div></li><li><div class="sidebar-group"><p class="sidebar-heading"><span>Other</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/other/markdown.html" class="sidebar-link">Markdown Cheatsheet</a></li><li><a href="/other/yaml_json.html" class="sidebar-link">YAML &amp; JSON</a></li><li><a href="/other/setup.html" class="sidebar-link">System Setup</a></li></ul></div></li></ul> </div> <div class="page"> <div class="content"><h1 id="docker"><a href="#docker" aria-hidden="true" class="header-anchor">#</a> Docker</h1> <hr> <p><strong>Version</strong></p> <div class="language-bash extra-class"><pre class="language-bash"><code>docker version
docker info
</code></pre></div><p><strong>Network</strong></p> <ul><li>Docker uses <code>docker0</code> virtual bridge interface. Each new container gets one interface automatically attached to the <code>docker0</code> virtual bridge.</li> <li>Create network that other container will attach to and will be visible via name: <code>docker network create -d bridge my-net</code> (<code>-d</code> Network Driver: bridge)</li> <li>Attach container to custom network: <code>docker run --network my-net ...</code></li></ul> <p><strong>Socket</strong><br>
Docker socket from within a container: <code>-v /run/docker.sock:/run/docker.sock</code></p> <p><strong>Manage Docker as a non-root user</strong>
The docker daemon binds to a Unix socket instead of a TCP port. By default that Unix socket is owned by the user root and other users can only access it using sudo. The docker daemon always runs as the root user.</p> <p>If you don’t want to use sudo when you use the docker command, create a Unix group called docker and add users to it. When the docker daemon starts, it makes the ownership of the Unix socket read/writable by the docker group.</p> <ul><li>Add the docker group if it doesn't already exist:</li></ul> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">sudo</span> <span class="token function">groupadd</span> docker
</code></pre></div><ul><li>Add the connected user &quot;$USER&quot; to the docker group. Change the user name to match your preferred user if you do not want to use your current user:</li></ul> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">sudo</span> gpasswd -a <span class="token variable">$USER</span> docker
</code></pre></div><ul><li><p>Log out/in to activate the changes to groups.</p></li> <li><p>You can use <code>docker run hello-world</code> to check if you can run docker without sudo.</p></li></ul> <h2 id="dockerfile"><a href="#dockerfile" aria-hidden="true" class="header-anchor">#</a> Dockerfile</h2> <p>Better way of installing things when building docker images:</p> <div class="language-Bash extra-class"><pre class="language-bash"><code>RUN <span class="token keyword">set</span> -ex<span class="token punctuation">;</span> \ <span class="token comment"># Fail when exit status not 0, print each command (debug)</span>
	<span class="token function">apt-get</span> update<span class="token punctuation">;</span> \
	<span class="token function">apt-get</span> <span class="token function">install</span> -y --no-install-recommends \
</code></pre></div><h2 id="build-push"><a href="#build-push" aria-hidden="true" class="header-anchor">#</a> Build &amp; Push</h2> <p>Run docker build inside a directory containing single file called <strong>Dockerfile</strong></p> <table><thead><tr><th>Command</th> <th style="text-align:left">What it does</th></tr></thead> <tbody><tr><td><code>docker build -t Registry/Image:tag .</code></td> <td style="text-align:left">Build Docker image (-t with tag)</td></tr> <tr><td><code>docker build -t registry/image:tag registry/image:another_tag .</code></td> <td style="text-align:left">Build image and use multiple tags</td></tr> <tr><td><code>docker build -f Dockerfile_custom -t docker.mot-solutions.com/msi/sessionmanager .</code></td> <td style="text-align:left">Specify custom Dockerfile</td></tr> <tr><td><code>docker push docker.mot-solutions.com/msi/sessionmanager</code></td> <td style="text-align:left">Push built image to registry</td></tr> <tr><td><code>docker build --no-cache ...</code></td> <td style="text-align:left">Force Docker to clean rebuild every layer</td></tr> <tr><td><code>docker tag 0e5574283393 fedora/httpd:version1.0</code></td> <td style="text-align:left">Tag an image referenced by ID</td></tr> <tr><td><code>docker tag httpd fedora/httpd:version1.0</code></td> <td style="text-align:left">Tag an image referenced by Name</td></tr> <tr><td><code>docker tag httpd:test fedora/httpd:version1.0.test</code></td> <td style="text-align:left">Tag an image referenced by Name and Tag</td></tr></tbody></table> <h2 id="run"><a href="#run" aria-hidden="true" class="header-anchor">#</a> Run</h2> <table><thead><tr><th>docker run ...</th> <th>Explained</th></tr></thead> <tbody><tr><td><code>-d</code></td> <td>In background, detached</td></tr> <tr><td><code>--name some-name</code></td> <td>Use some-name for container Name</td></tr> <tr><td><code>-ti</code></td> <td>Interactive, with pseudo terminal</td></tr> <tr><td><code>-p HOST:CONTAINER</code></td> <td>Port mapping Ex. <code>-p 8080:80</code></td></tr> <tr><td><code>--rm</code></td> <td>Remove after container stops</td></tr> <tr><td><code>--privileged</code></td> <td>Disable SELinux protection for this container</td></tr> <tr><td><code>ctrl+p ctrl+q</code></td> <td>Detach from container without stopping it</td></tr> <tr><td><code>-v</code></td> <td>Volume Mapping Ex. <code>-v ${PWD}/config:/config</code></td></tr> <tr><td><code>-v /run/docker.sock:/run/docker.sock</code></td> <td>Map Docker socket</td></tr> <tr><td><code>--network my-net</code></td> <td>Use &quot;my-net&quot; network</td></tr> <tr><td><code>--restart</code></td> <td>Specify restart policy: no, on-failure, always, unless-stopped</td></tr></tbody></table> <p><strong>Examples:</strong></p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># RUN</span>
docker run -d --name my_container -v <span class="token variable">$PWD</span>:/directory image:tag <span class="token comment"># Detached (in background)</span>
docker run -it image:tag <span class="token function">bash</span> <span class="token comment"># Run bash shell inside of a container</span>
docker run -d alpine:latest sh -c <span class="token string">'while true; do date; sleep 1; done'</span>
docker run -p 8080:80 --name -e VAR<span class="token operator">=</span>Value my_container image:tag  <span class="token comment"># docker run -p 8080:80</span>
docker run --restart<span class="token operator">=</span>always redis

<span class="token comment"># COPY</span>
docker <span class="token function">cp</span> foo.txt mycontainer:/foo.txt                        <span class="token comment"># Copy from host to container</span>
docker <span class="token function">cp</span> mycontainer:/foo.txt foo.txt                        <span class="token comment"># Copy form container to host</span>
</code></pre></div><h2 id="manage"><a href="#manage" aria-hidden="true" class="header-anchor">#</a> Manage</h2> <table><thead><tr><th>Command</th> <th style="text-align:left">What it does</th></tr></thead> <tbody><tr><td><code>docker newtork ls</code></td> <td style="text-align:left">List Docker networks</td></tr> <tr><td><code>docker volume ls</code></td> <td style="text-align:left">List Docker volumes</td></tr> <tr><td><code>docker ps</code></td> <td style="text-align:left">Show running containers</td></tr> <tr><td><code>docker ps -a</code></td> <td style="text-align:left">Show all containers (including stopped)</td></tr> <tr><td><code>docker exec -it &lt;my_container&gt; bash</code></td> <td style="text-align:left">Attach to a running container with BASH shell</td></tr> <tr><td><code>docker kill &lt;my_container&gt;</code></td> <td style="text-align:left">Kill running container</td></tr> <tr><td><code>docker rm &lt;my_container&gt;</code></td> <td style="text-align:left">Remove the container (including data inside)</td></tr> <tr><td><code>docker stats</code></td> <td style="text-align:left">Show Docker container system stats (CPU, Mem, IOs)</td></tr> <tr><td><code>docker stats &lt;my_container&gt;</code></td> <td style="text-align:left">Show stats for a single container</td></tr> <tr><td><code>docker logs &lt;my_container&gt;</code></td> <td style="text-align:left">Show logs from a container</td></tr> <tr><td><code>docker inspect &lt;my_container&gt;</code></td> <td style="text-align:left">Return low-level information on Docker objects in JSON format</td></tr> <tr><td><code>docker history &lt;image&gt;</code></td> <td style="text-align:left">Show the history of an image</td></tr></tbody></table> <h2 id="system"><a href="#system" aria-hidden="true" class="header-anchor">#</a> System</h2> <table><thead><tr><th>Command</th> <th style="text-align:left">What it does</th></tr></thead> <tbody><tr><td><code>docker system df</code></td> <td style="text-align:left">Show Docker disk usage</td></tr> <tr><td><code>docker system info</code></td> <td style="text-align:left">Display system-wide information</td></tr> <tr><td><code>docker system prune</code></td> <td style="text-align:left">Remove unused data</td></tr></tbody></table> <h2 id="docker-compose"><a href="#docker-compose" aria-hidden="true" class="header-anchor">#</a> Docker-Compose</h2> <p>User version 2 over version 3. The version 3 is used when using docker swarm and removes syntax used in version 2.</p> <table><thead><tr><th>What it does</th> <th style="text-align:left">Command</th></tr></thead> <tbody><tr><td>Stand Up docker-compose.yml stack</td> <td style="text-align:left"><code>docker-compose up -d</code></td></tr> <tr><td>Restart single service from docker-compose.yml</td> <td style="text-align:left"><code>docker-compose restart &lt;service&gt;</code></td></tr> <tr><td>Add service to docker-compose.yml and start it</td> <td style="text-align:left"><code>docker-compose up -d --no-recreate</code></td></tr></tbody></table> <h3 id="logs"><a href="#logs" aria-hidden="true" class="header-anchor">#</a> Logs</h3> <p>Show last 100 logs from docker-compose deployment</p> <div class="language-bash extra-class"><pre class="language-bash"><code>docker-compose logs
-f            <span class="token comment"># Follow log output</span>
-t            <span class="token comment"># Show timestamps</span>
--tail<span class="token operator">=</span><span class="token string">&quot;100&quot;</span>  <span class="token comment"># Number of lines to show from the end of the logs</span>
              <span class="token comment"># for each container</span>
</code></pre></div><h2 id="tips-tricks"><a href="#tips-tricks" aria-hidden="true" class="header-anchor">#</a> Tips &amp; Tricks</h2> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># ALIASES in .bashrc or .zshrc</span>
<span class="token function">alias</span> dps<span class="token operator">=</span><span class="token string">'docker ps --format &quot;table {{.Names}}\t{{.Image}}\t{{.Ports}}&quot;'</span>
</code></pre></div></div> <div class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated: </span> <span class="time">9/7/2018, 8:48:17 PM</span></div></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/devops/cicd.html" class="prev">
          CI/CD
        </a></span> <span class="next"><a href="/devops/databases.html">
          Database Technologies
        </a>
        →
      </span></p></div> </div> <!----></div></div>
    <script src="/assets/js/14.f59d9620.js" defer></script><script src="/assets/js/app.8ced4ed7.js" defer></script>
  </body>
</html>
