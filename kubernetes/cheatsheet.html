<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Cheatsheet | Tadone Vuepress</title>
    <meta name="description" content="Tadone Vuepress">
    <link rel="icon" href="/logo.png">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <link rel="apple-touch-icon" href="/icons/apple-touch-icon-152x152.png">
  <link rel="mask-icon" href="/icons/safari-pinned-tab.svg" color="#3eaf7c">
  <meta name="msapplication-TileImage" content="/icons/msapplication-icon-144x144.png">
  <meta name="msapplication-TileColor" content="#000000">
    
    <link rel="preload" href="/assets/css/0.styles.d9b151b8.css" as="style"><link rel="preload" href="/assets/js/app.26e34d64.js" as="script"><link rel="preload" href="/assets/js/18.712774dc.js" as="script"><link rel="prefetch" href="/assets/js/10.89ae5d30.js"><link rel="prefetch" href="/assets/js/11.a75a28d9.js"><link rel="prefetch" href="/assets/js/12.97cb21a4.js"><link rel="prefetch" href="/assets/js/13.63fba130.js"><link rel="prefetch" href="/assets/js/14.3f23b28e.js"><link rel="prefetch" href="/assets/js/15.5c212fdd.js"><link rel="prefetch" href="/assets/js/16.6c4741f5.js"><link rel="prefetch" href="/assets/js/17.316138ad.js"><link rel="prefetch" href="/assets/js/19.8cac1d03.js"><link rel="prefetch" href="/assets/js/2.fcb46994.js"><link rel="prefetch" href="/assets/js/20.c6295b52.js"><link rel="prefetch" href="/assets/js/21.4f5dd63e.js"><link rel="prefetch" href="/assets/js/22.b8c50060.js"><link rel="prefetch" href="/assets/js/23.d068b859.js"><link rel="prefetch" href="/assets/js/24.00bae11a.js"><link rel="prefetch" href="/assets/js/25.7c783b56.js"><link rel="prefetch" href="/assets/js/26.fc534f83.js"><link rel="prefetch" href="/assets/js/27.f7fd5b9e.js"><link rel="prefetch" href="/assets/js/28.bebfaf48.js"><link rel="prefetch" href="/assets/js/29.1c3a4caf.js"><link rel="prefetch" href="/assets/js/3.fc9eb5c0.js"><link rel="prefetch" href="/assets/js/30.a1a7b142.js"><link rel="prefetch" href="/assets/js/31.074b511e.js"><link rel="prefetch" href="/assets/js/32.2f76116b.js"><link rel="prefetch" href="/assets/js/33.1e7f1c30.js"><link rel="prefetch" href="/assets/js/34.63fbe35b.js"><link rel="prefetch" href="/assets/js/35.47a5079a.js"><link rel="prefetch" href="/assets/js/36.a47a0a4e.js"><link rel="prefetch" href="/assets/js/37.3580690c.js"><link rel="prefetch" href="/assets/js/38.e86d7803.js"><link rel="prefetch" href="/assets/js/39.e89f71d4.js"><link rel="prefetch" href="/assets/js/4.069b95dd.js"><link rel="prefetch" href="/assets/js/40.889340c7.js"><link rel="prefetch" href="/assets/js/5.417dffac.js"><link rel="prefetch" href="/assets/js/6.f52330c7.js"><link rel="prefetch" href="/assets/js/7.e6b95d50.js"><link rel="prefetch" href="/assets/js/8.2b154f0d.js"><link rel="prefetch" href="/assets/js/9.cd3c1513.js">
    <link rel="stylesheet" href="/assets/css/0.styles.d9b151b8.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Tadone Vuepress</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">Home</a></div><div class="nav-item"><a href="https://github.com/tadone" target="_blank" rel="noopener noreferrer" class="nav-link external">
  My GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">Home</a></div><div class="nav-item"><a href="https://github.com/tadone" target="_blank" rel="noopener noreferrer" class="nav-link external">
  My GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><div class="sidebar-group first"><p class="sidebar-heading"><span>Cloud</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/cloud/aws.html" class="sidebar-link">AWS</a></li><li><a href="/cloud/azure.html" class="sidebar-link">Azure</a></li></ul></div></li><li><div class="sidebar-group"><p class="sidebar-heading"><span>Code</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/code/git.html" class="sidebar-link">Git</a></li><li><a href="/code/bash.html" class="sidebar-link">Bash Scripting</a></li><li><a href="/code/python.html" class="sidebar-link">Python</a></li><li><a href="/code/python/list.html" class="sidebar-link">Python Lists</a></li><li><a href="/code/python/class.html" class="sidebar-link">Python Classes</a></li></ul></div></li><li><div class="sidebar-group"><p class="sidebar-heading"><span>DevOps</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/devops/cicd.html" class="sidebar-link">CI/CD</a></li><li><a href="/devops/docker.html" class="sidebar-link">Docker</a></li><li><a href="/devops/databases.html" class="sidebar-link">Database Technologies</a></li><li><a href="/devops/sql.html" class="sidebar-link">SQL Basics</a></li></ul></div></li><li><div class="sidebar-group"><p class="sidebar-heading open"><span>Kubernetes</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/kubernetes/overview.html" class="sidebar-link">Overview</a></li><li><a href="/kubernetes/kubectl.html" class="sidebar-link">KubeCtl</a></li><li><a href="/kubernetes/cheatsheet.html" class="active sidebar-link">Cheatsheet</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/kubernetes/cheatsheet.html#common-commands" class="sidebar-link">Common Commands</a></li><li class="sidebar-sub-header"><a href="/kubernetes/cheatsheet.html#check-performance" class="sidebar-link">Check Performance</a></li><li class="sidebar-sub-header"><a href="/kubernetes/cheatsheet.html#resources-deletion" class="sidebar-link">Resources Deletion</a></li><li class="sidebar-sub-header"><a href="/kubernetes/cheatsheet.html#pod" class="sidebar-link">Pod</a></li><li class="sidebar-sub-header"><a href="/kubernetes/cheatsheet.html#pod-advanced" class="sidebar-link">Pod Advanced</a></li><li class="sidebar-sub-header"><a href="/kubernetes/cheatsheet.html#label-annotations" class="sidebar-link">Label &amp; Annotations</a></li><li class="sidebar-sub-header"><a href="/kubernetes/cheatsheet.html#deployment-scale" class="sidebar-link">Deployment &amp; Scale</a></li><li class="sidebar-sub-header"><a href="/kubernetes/cheatsheet.html#quota-limits-resource" class="sidebar-link">Quota &amp; Limits &amp; Resource</a></li><li class="sidebar-sub-header"><a href="/kubernetes/cheatsheet.html#service" class="sidebar-link">Service</a></li><li class="sidebar-sub-header"><a href="/kubernetes/cheatsheet.html#statefulset" class="sidebar-link">StatefulSet</a></li><li class="sidebar-sub-header"><a href="/kubernetes/cheatsheet.html#volumes-volume-claims" class="sidebar-link">Volumes &amp; Volume Claims</a></li><li class="sidebar-sub-header"><a href="/kubernetes/cheatsheet.html#security" class="sidebar-link">Security</a></li><li class="sidebar-sub-header"><a href="/kubernetes/cheatsheet.html#extenstions" class="sidebar-link">Extenstions</a></li><li class="sidebar-sub-header"><a href="/kubernetes/cheatsheet.html#components-services" class="sidebar-link">Components &amp; Services</a></li><li class="sidebar-sub-header"><a href="/kubernetes/cheatsheet.html#other-components" class="sidebar-link">Other Components</a></li><li class="sidebar-sub-header"><a href="/kubernetes/cheatsheet.html#basic" class="sidebar-link">Basic</a></li><li class="sidebar-sub-header"><a href="/kubernetes/cheatsheet.html#names-of-certificates-files" class="sidebar-link">Names of certificates files</a></li><li class="sidebar-sub-header"><a href="/kubernetes/cheatsheet.html#misc-scripts" class="sidebar-link">Misc scripts</a></li><li class="sidebar-sub-header"><a href="/kubernetes/cheatsheet.html#helm-the-kubernetes-package-manager" class="sidebar-link">Helm: The Kubernetes Package Manager</a></li><li class="sidebar-sub-header"><a href="/kubernetes/cheatsheet.html#metric-server" class="sidebar-link">Metric Server</a></li></ul></li><li><a href="/kubernetes/configuration.html" class="sidebar-link">Configuration</a></li><li><a href="/kubernetes/objects_configs.html" class="sidebar-link">Objects: Data-In</a></li><li><a href="/kubernetes/objects_volumes.html" class="sidebar-link">Objects: Volumes</a></li><li><a href="/kubernetes/objects_deployments.html" class="sidebar-link">Objects: Deployments</a></li><li><a href="/kubernetes/objects_services_ingress.html" class="sidebar-link">Objects: Services &amp; Ingress</a></li><li><a href="/kubernetes/cluster.html" class="sidebar-link">My Clusters</a></li><li><a href="/kubernetes/troubleshooting.html" class="sidebar-link">Troubleshooting</a></li></ul></div></li><li><div class="sidebar-group"><p class="sidebar-heading"><span>Linux</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/linux/bash_shell.html" class="sidebar-link">Bash Shell</a></li><li><a href="/linux/linux_basics.html" class="sidebar-link">Fundementals</a></li><li><a href="/linux/linux_metrics.html" class="sidebar-link">Metrics</a></li><li><a href="/linux/linux_tools.html" class="sidebar-link">GNU Tools</a></li></ul></div></li><li><div class="sidebar-group"><p class="sidebar-heading"><span>Other</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/other/markdown.html" class="sidebar-link">Markdown Cheatsheet</a></li><li><a href="/other/yaml_json.html" class="sidebar-link">YAML &amp; JSON</a></li><li><a href="/other/setup.html" class="sidebar-link">System Setup</a></li></ul></div></li></ul> </div> <div class="page"> <div class="content"><h1 id="kubectl-kubernetes-cheatsheet"><a href="#kubectl-kubernetes-cheatsheet" aria-hidden="true" class="header-anchor">#</a> Kubectl Kubernetes CheatSheet</h1> <h2 id="common-commands"><a href="#common-commands" aria-hidden="true" class="header-anchor">#</a> Common Commands</h2> <table><thead><tr><th>Name</th> <th>Command</th></tr></thead> <tbody><tr><td>List everything</td> <td><code>kubectl get all --all-namespaces</code></td></tr> <tr><td>List pods with nodes info</td> <td><code>kubectl get pod -o wide</code></td></tr> <tr><td>Validate yaml file with dry run</td> <td><code>kubectl apply --dry-run --validate -f pod-dummy.yaml</code></td></tr> <tr><td>Diff deployed resource with local yaml file</td> <td><code>kubectl alpha diff -f &lt;yaml file/dir&gt;</code></td></tr> <tr><td>Start a temporary pod for testing</td> <td><code>kubectl run --rm -i -t --image=alpine test-$RANDOM -- sh</code></td></tr> <tr><td>Run wget test temporarily</td> <td><code>kubectl run --rm mytest --image=busybox -it</code></td></tr> <tr><td>Run curl test temporarily</td> <td><code>kubectl run --rm mytest --image=yauritux/busybox-curl -it</code></td></tr> <tr><td>kubectl run shell command</td> <td><code>kubectl exec -it mytest -- ls -l /etc/hosts</code></td></tr> <tr><td>Get system conf via configmap</td> <td><code>kubectl -n kube-system get cm kubeadm-config -o yaml</code></td></tr> <tr><td>kubectl run instance with replicas</td> <td><code>kubectl run my-nginx --image=nginx --replicas=2 --port=80</code></td></tr> <tr><td>Explain resource</td> <td><code>kubectl explain pods=</code>, <code>kubectl explain svc</code></td></tr> <tr><td>Get all services</td> <td><code>kubectl get service --all-namespaces</code></td></tr> <tr><td>Query healthcheck endpoint</td> <td><code>curl -L http://127.0.0.1:10250/healthz</code></td></tr> <tr><td>Open a bash terminal in a pod</td> <td><code>kubectl exec -it storage sh</code></td></tr> <tr><td>Check pod environment variables</td> <td><code>kubectl exec redis-master-ft9ex env</code></td></tr> <tr><td>Enable kubectl shell autocompletion</td> <td><code>echo &quot;source &lt;(kubectl completion bash)&quot; &gt;&gt;~/.bashrc</code>, and reload</td></tr> <tr><td>Use minikube dockerd in your laptop</td> <td><code>eval $(minikube docker-env)</code>, No need to push docker hub any more</td></tr> <tr><td>Get services sorted by name</td> <td><code>kubectl get services --sort-by=.metadata.name</code></td></tr> <tr><td>Get pods sorted by restart count</td> <td><code>kubectl get pods --sort-by='.status.containerStatuses[0].restartCount'</code></td></tr> <tr><td>Get logs from init container</td> <td><code>kubectl logs &lt;pod-name&gt; -c &lt;init-container-2</code></td></tr> <tr><td>Drain a nodes</td> <td><code>kubectl drain &lt;node_name&gt; --delete-local-data --ignore-daemonsets</code></td></tr></tbody></table> <h2 id="check-performance"><a href="#check-performance" aria-hidden="true" class="header-anchor">#</a> Check Performance</h2> <table><thead><tr><th>Name</th> <th>Command</th></tr></thead> <tbody><tr><td>Get node resource usage</td> <td><code>kubectl top node</code></td></tr> <tr><td>Get pod resource usage</td> <td><code>kubectl top pod</code></td></tr> <tr><td>Get resource usage for a given pod</td> <td><code>kubectl top &lt;podname&gt; --containers</code></td></tr> <tr><td>List resource utilization for all containers</td> <td><code>kubectl top pod --all-namespaces --containers=true</code></td></tr></tbody></table> <h2 id="resources-deletion"><a href="#resources-deletion" aria-hidden="true" class="header-anchor">#</a> Resources Deletion</h2> <table><thead><tr><th>Name</th> <th>Command</th></tr></thead> <tbody><tr><td>Delete pod</td> <td><code>kubectl delete pod/&lt;pod-name&gt; -n &lt;my-namespace&gt;</code></td></tr> <tr><td>Force delete</td> <td><code>kubectl delete pod NAME --grace-period=0 --force</code></td></tr> <tr><td>Delete pods by labels</td> <td><code>kubectl delete pod -l env=test</code></td></tr> <tr><td>Delete deployments by labels</td> <td><code>kubectl delete deployment -l app=wordpress</code></td></tr> <tr><td>Delete all resources filtered by labels</td> <td><code>kubectl delete pods,services -l name=myLabel</code></td></tr> <tr><td>Delete resources under a namespace</td> <td><code>kubectl -n my-ns delete po,svc --all</code></td></tr> <tr><td>Delete persist volumes by labels</td> <td><code>kubectl delete pvc -l app=wordpress</code></td></tr> <tr><td>Delete statefulset only (not pods)</td> <td><code>kubectl delete sts/&lt;stateful_set_name&gt; --cascade=false</code></td></tr></tbody></table> <h2 id="pod"><a href="#pod" aria-hidden="true" class="header-anchor">#</a> Pod</h2> <table><thead><tr><th>Name</th> <th>Command</th></tr></thead> <tbody><tr><td>List all pods</td> <td><code>kubectl get pods</code></td></tr> <tr><td>List pods for all namespace</td> <td><code>kubectl get pods -all-namespaces</code></td></tr> <tr><td>List all critical pods</td> <td><code>kubectl get -n kube-system pods -a</code></td></tr> <tr><td>List pods with more info</td> <td><code>kubectl get pod -o wide=</code>, <code>kubectl get pod/&lt;pod-name&gt; -o yaml</code></td></tr> <tr><td>Get pod info</td> <td><code>kubectl describe pod/srv-mysql-server</code></td></tr> <tr><td>List all pods with labels</td> <td><code>kubectl get pods --show-labels</code></td></tr> <tr><td>kubectl run command</td> <td><code>kubectl exec -it -n &quot;$ns&quot; &quot;$podname&quot; -- sh -c &quot;echo $msg &gt;&gt;/dev/err.log&quot;</code></td></tr></tbody></table> <h2 id="pod-advanced"><a href="#pod-advanced" aria-hidden="true" class="header-anchor">#</a> Pod Advanced</h2> <table><thead><tr><th>Name</th> <th>Command</th></tr></thead> <tbody><tr><td>Get pod by selector</td> <td><code>kubectl get pods -n $namespace --selector=&quot;app=syslog&quot; -o jsonpath='{.items[*].metadata.name}')</code></td></tr> <tr><td>List pods and containers</td> <td><code>kubectl get pods -o='custom-columns=PODS:.metadata.name,CONTAINERS:.spec.containers[*].name'</code></td></tr> <tr><td>List pods, containers and images</td> <td><code>kubectl get pods -o='custom-columns=PODS:.metadata.name,CONTAINERS:.spec.containers[*].name,Images:.spec.containers[*].image'</code></td></tr></tbody></table> <h2 id="label-annotations"><a href="#label-annotations" aria-hidden="true" class="header-anchor">#</a> Label &amp; Annotations</h2> <table><thead><tr><th>Name</th> <th>Command</th></tr></thead> <tbody><tr><td>Filter pods by label</td> <td><code>kubectl get pods -l owner=denny</code></td></tr> <tr><td>Manually add label to a pod</td> <td><code>kubectl label pods dummy-input owner=denny</code></td></tr> <tr><td>Remove label</td> <td><code>kubectl label pods dummy-input owner-</code></td></tr> <tr><td>Manually add annonation to a pod</td> <td><code>kubectl annotate pods dummy-input my-url=https://www.dennyzhang.com</code></td></tr></tbody></table> <h2 id="deployment-scale"><a href="#deployment-scale" aria-hidden="true" class="header-anchor">#</a> Deployment &amp; Scale</h2> <table><thead><tr><th>Name</th> <th>Command</th></tr></thead> <tbody><tr><td>Scale out</td> <td><code>kubectl scale --replicas=3 deployment/nginx-app</code></td></tr> <tr><td>Online rolling upgrade</td> <td><code>kubectl rollout app-v1 app-v2 --image=img:v2</code></td></tr> <tr><td>Roll backup</td> <td><code>kubectl rollout app-v1 app-v2 --rollback</code></td></tr> <tr><td>List rollout</td> <td><code>kubectl get rs</code></td></tr> <tr><td>Check update status</td> <td><code>kubectl rollout status deployment/nginx-app</code></td></tr> <tr><td>Check update history</td> <td><code>kubectl rollout history deployment/nginx-app</code></td></tr> <tr><td>Pause/Resume</td> <td><code>kubectl rollout pause deployment/nginx-deployment=</code>, <code>resume</code></td></tr> <tr><td>Rollback to previous version</td> <td><code>kubectl rollout undo deployment/nginx-deployment</code></td></tr></tbody></table> <h2 id="quota-limits-resource"><a href="#quota-limits-resource" aria-hidden="true" class="header-anchor">#</a> Quota &amp; Limits &amp; Resource</h2> <table><thead><tr><th>Name</th> <th>Command</th></tr></thead> <tbody><tr><td>List Resource Quota</td> <td><code>kubectl get resourcequota</code></td></tr> <tr><td>List Limit Range</td> <td><code>kubectl get limitrange</code></td></tr> <tr><td>Customize resource definition</td> <td><code>kubectl set resources deployment nginx -c=nginx --limits=cpu=200m,memory=512Mi</code></td></tr></tbody></table> <h2 id="service"><a href="#service" aria-hidden="true" class="header-anchor">#</a> Service</h2> <table><thead><tr><th>Name</th> <th>Command</th></tr></thead> <tbody><tr><td>List all services</td> <td><code>kubectl get services</code></td></tr> <tr><td>List service endpoints</td> <td><code>kubectl get endpoints</code></td></tr> <tr><td>Get service detail</td> <td><code>kubectl get service nginx-service -o yaml</code></td></tr> <tr><td>Expose deployment as lb service</td> <td><code>kubectl expose deployment/my-app --type=LoadBalancer --name=my-service</code></td></tr> <tr><td>Expose service as lb service</td> <td><code>kubectl expose service/wordpress-1-svc --type=LoadBalancer --name=wordpress-lb</code></td></tr></tbody></table> <h2 id="statefulset"><a href="#statefulset" aria-hidden="true" class="header-anchor">#</a> StatefulSet</h2> <table><thead><tr><th>Name</th> <th>Command</th></tr></thead> <tbody><tr><td>List statefulset</td> <td><code>kubectl get sts</code></td></tr> <tr><td>Delete statefulset only (not pods)</td> <td><code>kubectl delete sts/&lt;stateful_set_name&gt; --cascade=false</code></td></tr> <tr><td>Scale statefulset</td> <td><code>kubectl scale sts/&lt;stateful_set_name&gt; --replicas=5</code></td></tr></tbody></table> <h2 id="volumes-volume-claims"><a href="#volumes-volume-claims" aria-hidden="true" class="header-anchor">#</a> Volumes &amp; Volume Claims</h2> <table><thead><tr><th>Name</th> <th>Command</th></tr></thead> <tbody><tr><td>Check the mounted volumes</td> <td><code>kubectl exec storage ls /data</code></td></tr> <tr><td>Check persist volume</td> <td><code>kubectl describe pv/pv0001</code></td></tr> <tr><td>List storage class</td> <td><code>kubectl get storageclass</code></td></tr> <tr><td>Copy files</td> <td><code>kubectl cp /tmp/foo &lt;namespace1&gt;/&lt;pod1&gt;:/tmp/bar</code></td></tr></tbody></table> <h2 id="security"><a href="#security" aria-hidden="true" class="header-anchor">#</a> Security</h2> <table><thead><tr><th>Name</th> <th>Command</th></tr></thead> <tbody><tr><td>List certificates</td> <td><code>kubectl get csr</code></td></tr></tbody></table> <h2 id="extenstions"><a href="#extenstions" aria-hidden="true" class="header-anchor">#</a> Extenstions</h2> <table><thead><tr><th>Name</th> <th>Summary</th></tr></thead> <tbody><tr><td>List api group</td> <td><code>kubectl api-versions</code></td></tr> <tr><td>List all CRD</td> <td><code>kubectl get crd</code></td></tr></tbody></table> <h2 id="components-services"><a href="#components-services" aria-hidden="true" class="header-anchor">#</a> Components &amp; Services</h2> <h3 id="services-on-master-nodes"><a href="#services-on-master-nodes" aria-hidden="true" class="header-anchor">#</a> Services on Master Nodes</h3> <table><thead><tr><th>Name</th> <th>Summary</th></tr></thead> <tbody><tr><td>kube-apiserver</td> <td>exposes the Kubernetes API from master nodes</td></tr> <tr><td>etcd</td> <td>reliable data store for all k8s cluster data</td></tr> <tr><td>kube-scheduler</td> <td>schedule pods to run on selected nodes</td></tr> <tr><td>kube-controller-manager</td> <td>node controller, replication controller, endpoints controller, and service account &amp; token controllers</td></tr></tbody></table> <h3 id="services-on-worker-nodes"><a href="#services-on-worker-nodes" aria-hidden="true" class="header-anchor">#</a> Services on Worker Nodes</h3> <table><thead><tr><th>Name</th> <th>Summary</th></tr></thead> <tbody><tr><td>kubelet</td> <td>makes sure that containers are running in a pod</td></tr> <tr><td>kube-proxy</td> <td>perform connection forwarding</td></tr> <tr><td>Container Runtime</td> <td>Kubernetes supported runtimes: Docker, rkt, runc and any OCI runtime-spec implementation.</td></tr></tbody></table> <h3 id="tools"><a href="#tools" aria-hidden="true" class="header-anchor">#</a> Tools</h3> <table><thead><tr><th>Name</th> <th>Summary</th></tr></thead> <tbody><tr><td>kubectl</td> <td>the command line util to talk to k8s cluster</td></tr> <tr><td>kubeadm</td> <td>the command to bootstrap the cluster</td></tr> <tr><td>kubefed</td> <td>the command line to control a Kubernetes Cluster Federation</td></tr> <tr><td>Kubernetes Components</td> <td>Kubernetes Components</td></tr></tbody></table> <h2 id="other-components"><a href="#other-components" aria-hidden="true" class="header-anchor">#</a> Other Components</h2> <h3 id="log-files"><a href="#log-files" aria-hidden="true" class="header-anchor">#</a> Log files</h3> <table><thead><tr><th>Name</th> <th>Command</th></tr></thead> <tbody><tr><td>API Server.log in master node</td> <td><code>/var/log/kube-apiserver.log</code></td></tr> <tr><td>Scheduler.log in master node</td> <td><code>/var/log/kube-scheduler.log</code></td></tr> <tr><td>Controller.log in master node</td> <td><code>/var/log/kube-controller-manager.log</code></td></tr> <tr><td>Kubelet.log in worker node</td> <td><code>/var/log/kubelet.log</code></td></tr> <tr><td>Kube Proxy.log in worker node</td> <td><code>/var/log/kubelet-proxy.log</code></td></tr></tbody></table> <h3 id="events-metrics"><a href="#events-metrics" aria-hidden="true" class="header-anchor">#</a> Events &amp; Metrics</h3> <table><thead><tr><th>Name</th> <th>Command</th></tr></thead> <tbody><tr><td>View all events</td> <td><code>kubectl get events --all-namespaces</code></td></tr></tbody></table> <h3 id="namespace-security"><a href="#namespace-security" aria-hidden="true" class="header-anchor">#</a> Namespace &amp; Security</h3> <table><thead><tr><th>Name</th> <th>Command</th></tr></thead> <tbody><tr><td>List authenticated contexts</td> <td><code>kubectl config get-contexts</code></td></tr> <tr><td>Switch context</td> <td><code>kubectl config use-context &lt;cluster-name&gt;</code></td></tr> <tr><td>Delete the specified context</td> <td><code>kubectl config delete-context &lt;cluster-name&gt;</code></td></tr> <tr><td>List all namespaces defined</td> <td><code>kubectl get namespaces</code></td></tr> <tr><td>kubectl config file</td> <td><code>~/.kube/config</code></td></tr></tbody></table> <h3 id="network"><a href="#network" aria-hidden="true" class="header-anchor">#</a> Network</h3> <table><thead><tr><th>Name</th> <th>Command</th></tr></thead> <tbody><tr><td>Temporarily add a port-forwarding</td> <td><code>kubectl port-forward redis-izl09 6379</code></td></tr> <tr><td>Add port-forwaring for deployment</td> <td><code>kubectl port-forward deployment/redis-master 6379:6379</code></td></tr> <tr><td>Add port-forwaring for replicaset</td> <td><code>kubectl port-forward rs/redis-master 6379:6379</code></td></tr> <tr><td>Add port-forwaring for service</td> <td><code>kubectl port-forward svc/redis-master 6379:6379</code></td></tr> <tr><td>Get network policy</td> <td><code>kubectl get NetworkPolicy</code></td></tr></tbody></table> <h2 id="basic"><a href="#basic" aria-hidden="true" class="header-anchor">#</a> Basic</h2> <h3 id="key-concepts"><a href="#key-concepts" aria-hidden="true" class="header-anchor">#</a> Key Concepts</h3> <table><thead><tr><th>Name</th> <th>Summary</th></tr></thead> <tbody><tr><td>CNCF</td> <td>Cloud Native Computing Foundation</td></tr> <tr><td>CRI</td> <td>Container Runtime Interface</td></tr> <tr><td>CNI</td> <td>Container Network Interface</td></tr> <tr><td>CSI</td> <td>Container Storage Interface</td></tr></tbody></table> <h3 id="kubernetes-critical-files"><a href="#kubernetes-critical-files" aria-hidden="true" class="header-anchor">#</a> Kubernetes Critical Files</h3> <table><thead><tr><th>Name</th> <th>Comment</th></tr></thead> <tbody><tr><td>Config folder</td> <td><code>/etc/kubernetes/</code></td></tr> <tr><td>Certificate files</td> <td><code>/etc/kubernetes/pki/</code></td></tr> <tr><td>Credentials to API server</td> <td><code>/etc/kubernetes/kubelet.conf</code></td></tr> <tr><td>Superuser credentials</td> <td><code>/etc/kubernetes/admin.conf</code></td></tr> <tr><td>Kubernets working dir</td> <td><code>/var/lib/kubelet/</code></td></tr> <tr><td>Docker working dir</td> <td><code>/var/lib/docker/</code></td></tr> <tr><td>Etcd working dir</td> <td><code>/var/lib/etcd/</code></td></tr> <tr><td>Network cni</td> <td><code>/etc/cni/net.d/</code></td></tr> <tr><td>Docker container log</td> <td><code>/var/log/containers/</code></td></tr> <tr><td>Log files</td> <td><code>/var/log/pods/</code></td></tr> <tr><td>Env</td> <td><code>export KUBECONFIG=/etc/kubernetes/admin.conf</code></td></tr> <tr><td>Env</td> <td><code>/etc/systemd/system/kubelet.service.d/10-kubeadm.conf</code></td></tr></tbody></table> <h3 id="check-status"><a href="#check-status" aria-hidden="true" class="header-anchor">#</a> Check status</h3> <table><thead><tr><th>Name</th> <th>Summary</th></tr></thead> <tbody><tr><td>List everything</td> <td><code>kubectl get all --all-namespaces</code></td></tr> <tr><td>Get cluster info</td> <td><code>kubectl cluster-info</code></td></tr> <tr><td>Get configuration</td> <td><code>kubectl config view</code></td></tr> <tr><td>Get kubectl version</td> <td><code>kubectl version</code></td></tr> <tr><td>Get component status</td> <td><code>kubectl get componentstatus</code></td></tr> <tr><td>Similar to <code>docker ps</code></td> <td><code>kubectl get nodes</code></td></tr> <tr><td>Similar to <code>docker inspect</code></td> <td><code>kubectl describe pod/nginx-app-413181-cn</code></td></tr> <tr><td>Similar to <code>docker logs</code></td> <td><code>kubectl logs</code></td></tr> <tr><td>Similar to <code>docker exec</code></td> <td><code>kubectl exec</code></td></tr> <tr><td>Get services for current namespace</td> <td><code>kubectl get svc</code></td></tr> <tr><td>Get node status</td> <td><code>kubectl describe node/&lt;node_name&gt;</code></td></tr></tbody></table> <h2 id="names-of-certificates-files"><a href="#names-of-certificates-files" aria-hidden="true" class="header-anchor">#</a> Names of certificates files</h2> <p>Names of certificates files:</p> <ul><li><code>ca.crt, ca.key</code> (CA certificate)</li> <li><code>apiserver.crt, apiserver.key</code> (API server certificate)</li> <li><code>apiserver-kubelet-client.crt, apiserver-kubelet-client.key</code> (client certificate for the apiservers to connect to the kubelets securely)</li> <li><code>sa.pub, sa.key</code> (a private key for signing ServiceAccount )</li> <li><code>front-proxy-ca.crt, front-proxy-ca.key</code> (CA for the front proxy)</li> <li><code>front-proxy-client.crt, front-proxy-client.key</code> (client cert for the front proxy client)</li></ul> <h2 id="misc-scripts"><a href="#misc-scripts" aria-hidden="true" class="header-anchor">#</a> Misc scripts</h2> <h3 id="tail-pod-log-by-label"><a href="#tail-pod-log-by-label" aria-hidden="true" class="header-anchor">#</a> Tail pod log by label</h3> <div class="language-bash extra-class"><pre class="language-bash"><code>namespace<span class="token operator">=</span><span class="token string">&quot;mynamespace&quot;</span>
mylabel<span class="token operator">=</span><span class="token string">&quot;app=mylabel&quot;</span>
kubectl get pod -l <span class="token string">&quot;<span class="token variable">$mylabel</span>&quot;</span> -n <span class="token string">&quot;<span class="token variable">$namespace</span>&quot;</span> <span class="token operator">|</span> <span class="token function">tail</span> -n1 \
    <span class="token operator">|</span> <span class="token function">awk</span> -F<span class="token string">' '</span> <span class="token string">'{print <span class="token variable">$1</span>}'</span> <span class="token operator">|</span> <span class="token function">xargs</span> -I<span class="token punctuation">{</span><span class="token punctuation">}</span> \
      kubectl logs -n <span class="token string">&quot;<span class="token variable">$namespace</span>&quot;</span> -f <span class="token punctuation">{</span><span class="token punctuation">}</span>
</code></pre></div><h3 id="get-node-hardware-resource-utilization"><a href="#get-node-hardware-resource-utilization" aria-hidden="true" class="header-anchor">#</a> Get node hardware resource utilization</h3> <div class="language-bash extra-class"><pre class="language-bash"><code>kubectl get nodes --no-headers \
     <span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">'{print <span class="token variable">$1</span>}'</span> <span class="token operator">|</span> <span class="token function">xargs</span> -I <span class="token punctuation">{</span><span class="token punctuation">}</span> \
     sh -c <span class="token string">'echo {}; kubectl describe node {} | grep Allocated -A 5'</span>

kubectl get nodes --no-headers <span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">'{print <span class="token variable">$1</span>}'</span> <span class="token operator">|</span> <span class="token function">xargs</span> -I <span class="token punctuation">{</span><span class="token punctuation">}</span> \
    sh -c <span class="token string">'echo {}; kubectl describe node {} | grep Allocated -A 5 \
     | grep -ve Event -ve Allocated -ve percent -ve -- ; echo'</span>
</code></pre></div><h3 id="apply-yaml-files-recursively"><a href="#apply-yaml-files-recursively" aria-hidden="true" class="header-anchor">#</a> Apply yaml files recursively</h3> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># create</span>
<span class="token function">time</span> <span class="token function">ls</span> -1 */*.yml <span class="token operator">|</span> <span class="token function">grep</span> -v namespace <span class="token operator">|</span> <span class="token function">xargs</span> -I<span class="token punctuation">{</span><span class="token punctuation">}</span> kubectl apply -f <span class="token punctuation">{</span><span class="token punctuation">}</span>

<span class="token comment"># delete</span>
<span class="token function">time</span> <span class="token function">ls</span> -1r */*.yml <span class="token operator">|</span> <span class="token function">grep</span> -v namespace <span class="token operator">|</span> <span class="token function">xargs</span> -I<span class="token punctuation">{</span><span class="token punctuation">}</span> kubectl delete -f <span class="token punctuation">{</span><span class="token punctuation">}</span>
</code></pre></div><h3 id="apply-the-configuration-in-manifest-yaml-and-delete-all-the-other-configmaps-that-are-not-in-the-file"><a href="#apply-the-configuration-in-manifest-yaml-and-delete-all-the-other-configmaps-that-are-not-in-the-file" aria-hidden="true" class="header-anchor">#</a> Apply the configuration in manifest.yaml and delete all the other configmaps that are not in the file.</h3> <div class="language-bash extra-class"><pre class="language-bash"><code>kaubectl apply --prune -f manifest.yaml --all --prune-whitelist<span class="token operator">=</span>core/v1/ConfigMap
</code></pre></div><h3 id="list-all-critical-pods"><a href="#list-all-critical-pods" aria-hidden="true" class="header-anchor">#</a> List all critical pods</h3> <div class="language-bash extra-class"><pre class="language-bash"><code>kubectl --namespace kube-system get pods

<span class="token keyword">for</span> pod <span class="token keyword">in</span> <span class="token variable"><span class="token variable">$(</span>kubectl --namespace kube-system get pods -o jsonpath<span class="token operator">=</span><span class="token string">&quot;{.items[*].metadata.name}&quot;</span><span class="token variable">)</span></span><span class="token punctuation">;</span> <span class="token keyword">do</span>
    node_info<span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span>kubectl --namespace kube-system describe pod $pod <span class="token operator">|</span> <span class="token function">grep</span> <span class="token string">&quot;Node:&quot;</span><span class="token variable">)</span></span>
    <span class="token keyword">echo</span> <span class="token string">&quot;Pod: <span class="token variable">$pod</span>, <span class="token variable">$node_info</span>&quot;</span>
<span class="token keyword">done</span>
</code></pre></div><h2 id="helm-the-kubernetes-package-manager"><a href="#helm-the-kubernetes-package-manager" aria-hidden="true" class="header-anchor">#</a> Helm: The Kubernetes Package Manager</h2> <table><thead><tr><th>Name</th> <th>Summary</th></tr></thead> <tbody><tr><td>Helm</td> <td>a chart manager.</td></tr> <tr><td>Charts</td> <td>packages of pre-configured Kubernetes resources.</td></tr> <tr><td>Release</td> <td>a collection of Kubernetes resources deployed to the cluster using Helm.</td></tr> <tr><td>tiller</td> <td>helm server manages releases (installations) of your charts.</td></tr></tbody></table> <table><thead><tr><th>Name</th> <th>Summary</th></tr></thead> <tbody><tr><td>helm init</td> <td></td></tr> <tr><td>helm list</td> <td></td></tr> <tr><td>helm list -a</td> <td></td></tr> <tr><td>helm repo update</td> <td></td></tr> <tr><td>helm install stable/mysql</td> <td></td></tr> <tr><td>helm install --name mysql-release stable/mysql</td> <td></td></tr> <tr><td>helm inspect stable/mysql</td> <td></td></tr> <tr><td>helm status $helm_name</td> <td></td></tr> <tr><td>helm delete $helm_name</td> <td></td></tr> <tr><td>helm delete --purge $helm_name</td> <td></td></tr> <tr><td>~/.helm/cache/archive</td> <td></td></tr></tbody></table> <p>Release, list, inspect, delete, rollback, purge</p> <h2 id="metric-server"><a href="#metric-server" aria-hidden="true" class="header-anchor">#</a> Metric Server</h2> <p>Metrics Server is a cluster-wide aggregator of resource usage data.
Metrics Server registered in the main API server through Kubernetes aggregator.</p> <table><thead><tr><th>Name</th> <th>Summary</th></tr></thead> <tbody><tr><td>Core metrics</td> <td>node/container level metrics; CPU, memory, disk and network, etc.</td></tr> <tr><td>Custom metrics</td> <td>refers to application metrics, e.g. HTTP request rate.</td></tr></tbody></table> <p>Today (Kubernetes 1.7), there are several sources of metrics within a Kubernetes cluster</p> <table><thead><tr><th>Name</th> <th>Summary</th></tr></thead> <tbody><tr><td>Heapster</td> <td>k8s add-on</td></tr> <tr><td>Cadvisor</td> <td>a standalone container/node metrics collection and monitoring tool.</td></tr> <tr><td>Kubernetes API</td> <td>does not track metrics. But can get real time metrics</td></tr></tbody></table> <p>Today, heapster is the source of the time-series data for the Kubernetes Dashboard.
All other Kubernetes components will supply their own metrics in a Prometheus format</p> <p>In logging domain, we can say <code>syslog</code> is the standard format
In metric domain, maybe we can choose <code>prometheus</code> as the standard format.</p></div> <div class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated: </span> <span class="time">1/4/2019, 5:58:57 PM</span></div></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/kubernetes/kubectl.html" class="prev">
          KubeCtl
        </a></span> <span class="next"><a href="/kubernetes/configuration.html">
          Configuration
        </a>
        →
      </span></p></div> </div> <!----></div></div>
    <script src="/assets/js/app.26e34d64.js" defer></script><script src="/assets/js/18.712774dc.js" defer></script>
  </body>
</html>
