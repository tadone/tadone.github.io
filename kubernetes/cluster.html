<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>My Clusters | Tadone Vuepress</title>
    <meta name="description" content="Tadone Vuepress">
    <link rel="icon" href="/logo.png">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <link rel="apple-touch-icon" href="/icons/apple-touch-icon-152x152.png">
  <link rel="mask-icon" href="/icons/safari-pinned-tab.svg" color="#3eaf7c">
  <meta name="msapplication-TileImage" content="/icons/msapplication-icon-144x144.png">
  <meta name="msapplication-TileColor" content="#000000">
    
    <link rel="preload" href="/assets/css/0.styles.d9b151b8.css" as="style"><link rel="preload" href="/assets/js/app.26e34d64.js" as="script"><link rel="preload" href="/assets/js/19.8cac1d03.js" as="script"><link rel="prefetch" href="/assets/js/10.89ae5d30.js"><link rel="prefetch" href="/assets/js/11.a75a28d9.js"><link rel="prefetch" href="/assets/js/12.97cb21a4.js"><link rel="prefetch" href="/assets/js/13.63fba130.js"><link rel="prefetch" href="/assets/js/14.3f23b28e.js"><link rel="prefetch" href="/assets/js/15.5c212fdd.js"><link rel="prefetch" href="/assets/js/16.6c4741f5.js"><link rel="prefetch" href="/assets/js/17.316138ad.js"><link rel="prefetch" href="/assets/js/18.712774dc.js"><link rel="prefetch" href="/assets/js/2.fcb46994.js"><link rel="prefetch" href="/assets/js/20.c6295b52.js"><link rel="prefetch" href="/assets/js/21.4f5dd63e.js"><link rel="prefetch" href="/assets/js/22.b8c50060.js"><link rel="prefetch" href="/assets/js/23.d068b859.js"><link rel="prefetch" href="/assets/js/24.00bae11a.js"><link rel="prefetch" href="/assets/js/25.7c783b56.js"><link rel="prefetch" href="/assets/js/26.fc534f83.js"><link rel="prefetch" href="/assets/js/27.f7fd5b9e.js"><link rel="prefetch" href="/assets/js/28.bebfaf48.js"><link rel="prefetch" href="/assets/js/29.1c3a4caf.js"><link rel="prefetch" href="/assets/js/3.fc9eb5c0.js"><link rel="prefetch" href="/assets/js/30.a1a7b142.js"><link rel="prefetch" href="/assets/js/31.074b511e.js"><link rel="prefetch" href="/assets/js/32.2f76116b.js"><link rel="prefetch" href="/assets/js/33.1e7f1c30.js"><link rel="prefetch" href="/assets/js/34.63fbe35b.js"><link rel="prefetch" href="/assets/js/35.47a5079a.js"><link rel="prefetch" href="/assets/js/36.a47a0a4e.js"><link rel="prefetch" href="/assets/js/37.3580690c.js"><link rel="prefetch" href="/assets/js/38.e86d7803.js"><link rel="prefetch" href="/assets/js/39.e89f71d4.js"><link rel="prefetch" href="/assets/js/4.069b95dd.js"><link rel="prefetch" href="/assets/js/40.889340c7.js"><link rel="prefetch" href="/assets/js/5.417dffac.js"><link rel="prefetch" href="/assets/js/6.f52330c7.js"><link rel="prefetch" href="/assets/js/7.e6b95d50.js"><link rel="prefetch" href="/assets/js/8.2b154f0d.js"><link rel="prefetch" href="/assets/js/9.cd3c1513.js">
    <link rel="stylesheet" href="/assets/css/0.styles.d9b151b8.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Tadone Vuepress</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">Home</a></div><div class="nav-item"><a href="https://github.com/tadone" target="_blank" rel="noopener noreferrer" class="nav-link external">
  My GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">Home</a></div><div class="nav-item"><a href="https://github.com/tadone" target="_blank" rel="noopener noreferrer" class="nav-link external">
  My GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><div class="sidebar-group first"><p class="sidebar-heading"><span>Cloud</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/cloud/aws.html" class="sidebar-link">AWS</a></li><li><a href="/cloud/azure.html" class="sidebar-link">Azure</a></li></ul></div></li><li><div class="sidebar-group"><p class="sidebar-heading"><span>Code</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/code/git.html" class="sidebar-link">Git</a></li><li><a href="/code/bash.html" class="sidebar-link">Bash Scripting</a></li><li><a href="/code/python.html" class="sidebar-link">Python</a></li><li><a href="/code/python/list.html" class="sidebar-link">Python Lists</a></li><li><a href="/code/python/class.html" class="sidebar-link">Python Classes</a></li></ul></div></li><li><div class="sidebar-group"><p class="sidebar-heading"><span>DevOps</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/devops/cicd.html" class="sidebar-link">CI/CD</a></li><li><a href="/devops/docker.html" class="sidebar-link">Docker</a></li><li><a href="/devops/databases.html" class="sidebar-link">Database Technologies</a></li><li><a href="/devops/sql.html" class="sidebar-link">SQL Basics</a></li></ul></div></li><li><div class="sidebar-group"><p class="sidebar-heading open"><span>Kubernetes</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/kubernetes/overview.html" class="sidebar-link">Overview</a></li><li><a href="/kubernetes/kubectl.html" class="sidebar-link">KubeCtl</a></li><li><a href="/kubernetes/cheatsheet.html" class="sidebar-link">Cheatsheet</a></li><li><a href="/kubernetes/configuration.html" class="sidebar-link">Configuration</a></li><li><a href="/kubernetes/objects_configs.html" class="sidebar-link">Objects: Data-In</a></li><li><a href="/kubernetes/objects_volumes.html" class="sidebar-link">Objects: Volumes</a></li><li><a href="/kubernetes/objects_deployments.html" class="sidebar-link">Objects: Deployments</a></li><li><a href="/kubernetes/objects_services_ingress.html" class="sidebar-link">Objects: Services &amp; Ingress</a></li><li><a href="/kubernetes/cluster.html" class="active sidebar-link">My Clusters</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/kubernetes/cluster.html#gce-cluster" class="sidebar-link">GCE Cluster</a></li><li class="sidebar-sub-header"><a href="/kubernetes/cluster.html#minkube-cluster" class="sidebar-link">Minkube Cluster</a></li></ul></li><li><a href="/kubernetes/troubleshooting.html" class="sidebar-link">Troubleshooting</a></li></ul></div></li><li><div class="sidebar-group"><p class="sidebar-heading"><span>Linux</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/linux/bash_shell.html" class="sidebar-link">Bash Shell</a></li><li><a href="/linux/linux_basics.html" class="sidebar-link">Fundementals</a></li><li><a href="/linux/linux_metrics.html" class="sidebar-link">Metrics</a></li><li><a href="/linux/linux_tools.html" class="sidebar-link">GNU Tools</a></li></ul></div></li><li><div class="sidebar-group"><p class="sidebar-heading"><span>Other</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/other/markdown.html" class="sidebar-link">Markdown Cheatsheet</a></li><li><a href="/other/yaml_json.html" class="sidebar-link">YAML &amp; JSON</a></li><li><a href="/other/setup.html" class="sidebar-link">System Setup</a></li></ul></div></li></ul> </div> <div class="page"> <div class="content"><h1 id="my-clusters"><a href="#my-clusters" aria-hidden="true" class="header-anchor">#</a> My Clusters</h1> <h2 id="gce-cluster"><a href="#gce-cluster" aria-hidden="true" class="header-anchor">#</a> GCE Cluster</h2> <p>Built using: console.cloud.google.com
The cluster consist of 3 nodes (VMs) that are built using <strong>gke-tad1-cluster-pool-micro</strong> template. Originally the cluster was set up with</p> <p>Cluster options:</p> <ul><li>Choose Zonal: us-west1-a</li> <li>Pick your kubernetes version: 1.10.7-gke.2</li> <li>Create a 3-node pool using the cheapest instance type - f1-micro (1 vCPU, 0.6 GB memory)</li> <li>Boot disk size to 10GB, (don't enable preemptible nodes. They're cheaper but IP changes every day)</li> <li>Enable auto-upgrade and auto-repair.</li></ul> <p>Below the node pool there are some additional options.</p> <ul><li>Disable HTTP load balancing (load balancing is expensive in GCP) and also</li> <li>Disable all the StackDriver stuff (also can be expensive and has flaky reliability in my experience) as well as - Disable the kubernetes dashboard</li></ul> <h3 id="gcloud-cli"><a href="#gcloud-cli" aria-hidden="true" class="header-anchor">#</a> GCloud CLI</h3> <div class="language-bash extra-class"><pre class="language-bash"><code>brew cask <span class="token function">install</span> google-cloud-sdk

<span class="token comment"># GCloud</span>
gcloud auth login
gcloud config <span class="token keyword">set</span> project kubernetes-tad1

<span class="token comment"># Obtain Kubernetes config file</span>
gcloud container clusters get-credentials tad1-cluster --zone<span class="token operator">=</span>us-west1-a

<span class="token comment"># Create cluster role-binding</span>
kubectl create clusterrolebinding cluster-admin-binding --clusterrole cluster-admin --user <span class="token variable"><span class="token variable">$(</span>gcloud config get-value account<span class="token variable">)</span></span>

<span class="token comment"># Same as above but with speciic user</span>
kubectl create clusterrolebinding myname-cluster-admin-binding \
  --clusterrole<span class="token operator">=</span>cluster-admin \
  --user<span class="token operator">=</span>tadone@gmail.com
</code></pre></div><h3 id="traefik-load-balancer"><a href="#traefik-load-balancer" aria-hidden="true" class="header-anchor">#</a> Traefik Load Balancer</h3> <p>To test out traefik.toml without valid certificate:</p> <div class="language-bash extra-class"><pre class="language-bash"><code>defaultEntryPoints <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&quot;http&quot;</span>, <span class="token string">&quot;https&quot;</span><span class="token punctuation">]</span>

<span class="token punctuation">[</span>entryPoints<span class="token punctuation">]</span>
  <span class="token punctuation">[</span>entryPoints.http<span class="token punctuation">]</span>
  address <span class="token operator">=</span> <span class="token string">&quot;:80&quot;</span>
    <span class="token punctuation">[</span>entryPoints.http.forwardedHeaders<span class="token punctuation">]</span>
      trustedIPs <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&quot;0.0.0.0/0&quot;</span><span class="token punctuation">]</span>
    <span class="token punctuation">[</span>entryPoints.http.redirect<span class="token punctuation">]</span>
      entryPoint <span class="token operator">=</span> <span class="token string">&quot;https&quot;</span>
  <span class="token punctuation">[</span>entryPoints.https<span class="token punctuation">]</span>
  address <span class="token operator">=</span> <span class="token string">&quot;:443&quot;</span>
    <span class="token punctuation">[</span>entryPoints.https.tls<span class="token punctuation">]</span>
    <span class="token punctuation">[</span>entryPoints.https.forwardedHeaders<span class="token punctuation">]</span>
      trustedIPs <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&quot;0.0.0.0/0&quot;</span><span class="token punctuation">]</span>
</code></pre></div><div class="warning custom-block"><p class="custom-block-title">WARNING</p> <p>Install minikube: <code>brew cask install minikube</code></p></div> <h2 id="minkube-cluster"><a href="#minkube-cluster" aria-hidden="true" class="header-anchor">#</a> Minkube Cluster</h2> <p>Minkube is used to test Kubernetes locally</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># Download hyperkit driver</span>
brew <span class="token function">install</span> hyperkit
<span class="token function">sudo</span> <span class="token function">chown</span> root:wheel <span class="token variable"><span class="token variable">$(</span>brew --prefix<span class="token variable">)</span></span>/opt/docker-machine-driver-hyperkit/bin/docker-machine-driver-hyperkit
<span class="token function">sudo</span> <span class="token function">chmod</span> u+s <span class="token variable"><span class="token variable">$(</span>brew --prefix<span class="token variable">)</span></span>/opt/docker-machine-driver-hyperkit/bin/docker-machine-driver-hyperkit
<span class="token comment"># Start minikube</span>
minikube start --vm-driver hyperkit

<span class="token comment"># Deploy hello-minikube image</span>
kubectl run hello-minikube --image<span class="token operator">=</span>k8s.gcr.io/echoserver:1.10 --port<span class="token operator">=</span>8080
<span class="token comment"># Create a Service object that exposes the deployment:</span>
kubectl expose deployment hello-minikube --type<span class="token operator">=</span>NodePort

<span class="token comment"># When the pod is running we can curl it</span>
<span class="token function">curl</span> <span class="token variable"><span class="token variable">$(</span>minikube <span class="token function">service</span> hello-minikube --url<span class="token variable">)</span></span>

<span class="token comment"># Clean up</span>
kubectl delete services hello-minikube
kubectl delete deployment hello-minikube
<span class="token comment"># Optionally stop minikube</span>
minikube stop
</code></pre></div><h3 id="create-service"><a href="#create-service" aria-hidden="true" class="header-anchor">#</a> Create Service</h3> <div class="warning custom-block"><p class="custom-block-title">WARNING</p> <p>Use a cloud provider like Google Kubernetes Engine or Amazon Web Services to create a Kubernetes cluster. This tutorial creates an external load balancer, which requires a cloud provider.</p> <p>Configure kubectl to communicate with your Kubernetes API server. For instructions, see the documentation for your cloud provider.</p></div> <p>Creating a service for an application running in five pods.</p> <ol><li>This command creates a Deployment object and an associated ReplicaSet object. The ReplicaSet has five Pods, each of which runs the Hello World application.</li></ol> <div class="language-bash extra-class"><pre class="language-bash"><code>kubectl run hello-world --replicas<span class="token operator">=</span>5 --labels<span class="token operator">=</span><span class="token string">&quot;run=load-balancer-example&quot;</span> --image<span class="token operator">=</span>gcr.io/google-samples/node-hello:1.0  --port<span class="token operator">=</span>8080
</code></pre></div><ol start="2"><li>Display information about the Deployment and ReplicaSets</li></ol> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># Deployment</span>
kubectl get deployments hello-world
kubectl describe deployments hello-world
<span class="token comment"># ReplicaSets</span>
kubectl get replicasets
kubectl describe replicasets
</code></pre></div><ol start="3"><li>Create a Service object that exposes the deployment:</li></ol> <div class="language-bash extra-class"><pre class="language-bash"><code>kubectl expose deployment hello-world --type<span class="token operator">=</span>LoadBalancer --name<span class="token operator">=</span>my-service
</code></pre></div><ol start="4"><li>Display information about the Service:</li></ol> <div class="language-bash extra-class"><pre class="language-bash"><code>kubectl get services my-service
kubectl describe services my-service
</code></pre></div><p>Make a note of the external IP address (<code>LoadBalancer Ingress</code>) exposed by your service. Also note the value of <code>Port</code> and <code>NodePort</code>.</p> <ul><li><code>Port</code> - internal to kubernetes</li> <li><code>NodePoert</code> - external to the world</li></ul> <ol start="5"><li>In the <code>describe services my-service</code> output, you can see that the service has several endpoints.  These are internal addresses of the pods that are running the Hello World application. To verify these are pod addresses, enter this command:</li></ol> <div class="language-bash extra-class"><pre class="language-bash"><code>kubectl get pods --output<span class="token operator">=</span>wide
</code></pre></div><p>Use the external IP address (LoadBalancer Ingress) to access the Hello World application:</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># Minikube (Will automatically open in browser)</span>
minikube <span class="token function">service</span> my-service
<span class="token comment"># Cloud provider</span>
<span class="token function">curl</span> http://<span class="token operator">&lt;</span>external-ip<span class="token operator">&gt;</span>:<span class="token operator">&lt;</span>port<span class="token operator">&gt;</span>
</code></pre></div><p>Where <code>&lt;external-ip&gt;</code> is the external IP address (<code>LoadBalancer Ingress</code>) of your Service, and <code>&lt;port&gt;</code> is the value of <code>Port</code> in your Service description. The response to a successful request is a hello message: <code>Hello Kubernetes!</code></p> <ol start="6"><li>Cleaning Up</li></ol> <div class="language-bash extra-class"><pre class="language-bash"><code>kubectl delete services my-service
kubectl delete deployment hello-world
</code></pre></div><h3 id="hostpath"><a href="#hostpath" aria-hidden="true" class="header-anchor">#</a> HostPath</h3> <p>HostPath (single node testing only – local storage is not supported in any way and <strong>WILL NOT WORK</strong> in a multi-node cluster)</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">kind</span><span class="token punctuation">:</span> PersistentVolume
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> gitlab<span class="token punctuation">-</span>data
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> gitlab
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">capacity</span><span class="token punctuation">:</span>
    <span class="token key atrule">storage</span><span class="token punctuation">:</span> 8Gi
  <span class="token key atrule">accessModes</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> ReadWriteMany
  <span class="token key atrule">hostPath</span><span class="token punctuation">:</span>
    <span class="token key atrule">path</span><span class="token punctuation">:</span> <span class="token string">&quot;/tmp/gitlab-data&quot;</span>
</code></pre></div></div> <div class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated: </span> <span class="time">11/2/2018, 10:26:10 PM</span></div></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/kubernetes/objects_services_ingress.html" class="prev">
          Objects: Services &amp; Ingress
        </a></span> <span class="next"><a href="/kubernetes/troubleshooting.html">
          Troubleshooting
        </a>
        →
      </span></p></div> </div> <!----></div></div>
    <script src="/assets/js/app.26e34d64.js" defer></script><script src="/assets/js/19.8cac1d03.js" defer></script>
  </body>
</html>
