<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Configuration | Tadone Vuepress</title>
    <meta name="description" content="Tadone Vuepress">
    <link rel="icon" href="/logo.png">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <link rel="apple-touch-icon" href="/icons/apple-touch-icon-152x152.png">
  <link rel="mask-icon" href="/icons/safari-pinned-tab.svg" color="#3eaf7c">
  <meta name="msapplication-TileImage" content="/icons/msapplication-icon-144x144.png">
  <meta name="msapplication-TileColor" content="#000000">
    
    <link rel="preload" href="/assets/css/0.styles.e6882789.css" as="style"><link rel="preload" href="/assets/js/app.ed8a5df2.js" as="script"><link rel="preload" href="/assets/js/20.457d13ca.js" as="script"><link rel="prefetch" href="/assets/js/10.57ac8f37.js"><link rel="prefetch" href="/assets/js/11.c27ad3cd.js"><link rel="prefetch" href="/assets/js/12.e3f125da.js"><link rel="prefetch" href="/assets/js/13.c1ba01d9.js"><link rel="prefetch" href="/assets/js/14.5cf3fbf8.js"><link rel="prefetch" href="/assets/js/15.d67da69d.js"><link rel="prefetch" href="/assets/js/16.799f5f32.js"><link rel="prefetch" href="/assets/js/17.1a7c4f5b.js"><link rel="prefetch" href="/assets/js/18.55aa3423.js"><link rel="prefetch" href="/assets/js/19.82753390.js"><link rel="prefetch" href="/assets/js/2.fcb46994.js"><link rel="prefetch" href="/assets/js/21.2342a659.js"><link rel="prefetch" href="/assets/js/22.412ca278.js"><link rel="prefetch" href="/assets/js/23.f6d2ee29.js"><link rel="prefetch" href="/assets/js/24.bc5c4f85.js"><link rel="prefetch" href="/assets/js/25.b5eef347.js"><link rel="prefetch" href="/assets/js/26.54065786.js"><link rel="prefetch" href="/assets/js/27.144dacc7.js"><link rel="prefetch" href="/assets/js/28.79a28376.js"><link rel="prefetch" href="/assets/js/29.0bc7fa25.js"><link rel="prefetch" href="/assets/js/3.eeb73190.js"><link rel="prefetch" href="/assets/js/30.849a3886.js"><link rel="prefetch" href="/assets/js/31.3e51818c.js"><link rel="prefetch" href="/assets/js/32.9e7b84f4.js"><link rel="prefetch" href="/assets/js/33.f00f2460.js"><link rel="prefetch" href="/assets/js/34.b1717a37.js"><link rel="prefetch" href="/assets/js/35.2ba5d738.js"><link rel="prefetch" href="/assets/js/36.f84d49ab.js"><link rel="prefetch" href="/assets/js/37.2b834aa2.js"><link rel="prefetch" href="/assets/js/38.28513fa2.js"><link rel="prefetch" href="/assets/js/39.fdbc69db.js"><link rel="prefetch" href="/assets/js/4.8df8b0d2.js"><link rel="prefetch" href="/assets/js/40.889340c7.js"><link rel="prefetch" href="/assets/js/5.0c376756.js"><link rel="prefetch" href="/assets/js/6.aa581904.js"><link rel="prefetch" href="/assets/js/7.c094cb2f.js"><link rel="prefetch" href="/assets/js/8.3d7e1a52.js"><link rel="prefetch" href="/assets/js/9.2397ffad.js">
    <link rel="stylesheet" href="/assets/css/0.styles.e6882789.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Tadone Vuepress</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">Home</a></div><div class="nav-item"><a href="https://github.com/tadone" target="_blank" rel="noopener noreferrer" class="nav-link external">
  My GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">Home</a></div><div class="nav-item"><a href="https://github.com/tadone" target="_blank" rel="noopener noreferrer" class="nav-link external">
  My GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><div class="sidebar-group first"><p class="sidebar-heading"><span>Cloud</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/cloud/aws.html" class="sidebar-link">AWS</a></li><li><a href="/cloud/azure.html" class="sidebar-link">Azure</a></li></ul></div></li><li><div class="sidebar-group"><p class="sidebar-heading"><span>Code</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/code/git.html" class="sidebar-link">Git</a></li><li><a href="/code/bash.html" class="sidebar-link">Bash Scripting</a></li><li><a href="/code/python.html" class="sidebar-link">Python</a></li><li><a href="/code/python/list.html" class="sidebar-link">Python Lists</a></li><li><a href="/code/python/class.html" class="sidebar-link">Python Classes</a></li></ul></div></li><li><div class="sidebar-group"><p class="sidebar-heading"><span>DevOps</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/devops/cicd.html" class="sidebar-link">CI/CD</a></li><li><a href="/devops/docker.html" class="sidebar-link">Docker</a></li><li><a href="/devops/databases.html" class="sidebar-link">Database Technologies</a></li><li><a href="/devops/sql.html" class="sidebar-link">SQL Basics</a></li></ul></div></li><li><div class="sidebar-group"><p class="sidebar-heading open"><span>Kubernetes</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/kubernetes/overview.html" class="sidebar-link">Overview</a></li><li><a href="/kubernetes/kubectl.html" class="sidebar-link">KubeCtl</a></li><li><a href="/kubernetes/cheatsheet.html" class="sidebar-link">Cheatsheet</a></li><li><a href="/kubernetes/configuration.html" class="active sidebar-link">Configuration</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/kubernetes/configuration.html#pod-env-variables" class="sidebar-link">Pod ENV Variables</a></li><li class="sidebar-sub-header"><a href="/kubernetes/configuration.html#pod-commands" class="sidebar-link">Pod Commands</a></li><li class="sidebar-sub-header"><a href="/kubernetes/configuration.html#session-affinity" class="sidebar-link">Session Affinity</a></li><li class="sidebar-sub-header"><a href="/kubernetes/configuration.html#liveness-readiness-probe" class="sidebar-link">Liveness &amp; Readiness Probe</a></li><li class="sidebar-sub-header"><a href="/kubernetes/configuration.html#image-pull-policy" class="sidebar-link">Image Pull Policy</a></li><li class="sidebar-sub-header"><a href="/kubernetes/configuration.html#cpu-memory-units" class="sidebar-link">CPU &amp; Memory Units</a></li><li class="sidebar-sub-header"><a href="/kubernetes/configuration.html#resource-limits" class="sidebar-link">Resource Limits</a></li><li class="sidebar-sub-header"><a href="/kubernetes/configuration.html#taints-and-tolerations" class="sidebar-link">Taints and Tolerations</a></li><li class="sidebar-sub-header"><a href="/kubernetes/configuration.html#node-selector" class="sidebar-link">Node Selector</a></li></ul></li><li><a href="/kubernetes/objects_configs.html" class="sidebar-link">Objects: Data-In</a></li><li><a href="/kubernetes/objects_volumes.html" class="sidebar-link">Objects: Volumes</a></li><li><a href="/kubernetes/objects_deployments.html" class="sidebar-link">Objects: Deployments</a></li><li><a href="/kubernetes/objects_services_ingress.html" class="sidebar-link">Objects: Services &amp; Ingress</a></li><li><a href="/kubernetes/cluster.html" class="sidebar-link">My Clusters</a></li><li><a href="/kubernetes/troubleshooting.html" class="sidebar-link">Troubleshooting</a></li></ul></div></li><li><div class="sidebar-group"><p class="sidebar-heading"><span>Linux</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/linux/bash_shell.html" class="sidebar-link">Bash Shell</a></li><li><a href="/linux/linux_basics.html" class="sidebar-link">Fundementals</a></li><li><a href="/linux/linux_metrics.html" class="sidebar-link">Metrics</a></li><li><a href="/linux/linux_tools.html" class="sidebar-link">GNU Tools</a></li></ul></div></li><li><div class="sidebar-group"><p class="sidebar-heading"><span>Other</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/other/markdown.html" class="sidebar-link">Markdown Cheatsheet</a></li><li><a href="/other/yaml_json.html" class="sidebar-link">YAML &amp; JSON</a></li><li><a href="/other/setup.html" class="sidebar-link">System Setup</a></li></ul></div></li></ul> </div> <div class="page"> <div class="content"><h1 id="kubernetes-configuration-options"><a href="#kubernetes-configuration-options" aria-hidden="true" class="header-anchor">#</a> Kubernetes Configuration Options</h1> <h2 id="pod-env-variables"><a href="#pod-env-variables" aria-hidden="true" class="header-anchor">#</a> Pod ENV Variables</h2> <p>Use environment variables to define arguments</p> <div class="language-bash extra-class"><pre class="language-bash"><code>env:
- name: MESSAGE
  value: <span class="token string">&quot;hello world&quot;</span>
command: <span class="token punctuation">[</span><span class="token string">&quot;/bin/echo&quot;</span><span class="token punctuation">]</span>
args: <span class="token punctuation">[</span><span class="token string">&quot;<span class="token variable"><span class="token variable">$(</span>MESSAGE<span class="token variable">)</span></span>&quot;</span><span class="token punctuation">]</span>
</code></pre></div><h2 id="pod-commands"><a href="#pod-commands" aria-hidden="true" class="header-anchor">#</a> Pod Commands</h2> <p>Run a command in a shell</p> <div class="language-bash extra-class"><pre class="language-bash"><code>command: <span class="token punctuation">[</span><span class="token string">&quot;/bin/sh&quot;</span><span class="token punctuation">]</span>
args: <span class="token punctuation">[</span><span class="token string">&quot;-c&quot;</span>, <span class="token string">&quot;while true; do echo hello; sleep 10; done&quot;</span><span class="token punctuation">]</span>
</code></pre></div><p>Example that will <code>printenv</code> HOSTNAME and KUBERNETES_PORT</p> <div class="language-yaml extra-class"><div class="highlight-lines"><br><br><br><br><br><br><br><br><br><div class="highlighted"> </div><br><br><br><br></div><pre class="language-yaml"><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Pod
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> command<span class="token punctuation">-</span>demo
  <span class="token key atrule">labels</span><span class="token punctuation">:</span>
    <span class="token key atrule">purpose</span><span class="token punctuation">:</span> demonstrate<span class="token punctuation">-</span>command
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">containers</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> command<span class="token punctuation">-</span>demo<span class="token punctuation">-</span>container
    <span class="token key atrule">image</span><span class="token punctuation">:</span> debian
    <span class="token key atrule">command</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;printenv&quot;</span><span class="token punctuation">]</span>
    <span class="token key atrule">args</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;HOSTNAME&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;KUBERNETES_PORT&quot;</span><span class="token punctuation">]</span>
  <span class="token key atrule">restartPolicy</span><span class="token punctuation">:</span> OnFailure
</code></pre></div><h2 id="session-affinity"><a href="#session-affinity" aria-hidden="true" class="header-anchor">#</a> Session Affinity</h2> <p>Enable Session Affinity (a.k.a Sticky Session) to Kubernetes service</p> <p>This would be the yaml file of the service:</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">kind</span><span class="token punctuation">:</span> Service
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> my<span class="token punctuation">-</span>service
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">selector</span><span class="token punctuation">:</span>
    <span class="token key atrule">app</span><span class="token punctuation">:</span> my<span class="token punctuation">-</span>app
  <span class="token key atrule">ports</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> http
    <span class="token key atrule">protocol</span><span class="token punctuation">:</span> TCP
    <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">80</span>
    <span class="token key atrule">targetPort</span><span class="token punctuation">:</span> <span class="token number">80</span>
  <span class="token key atrule">sessionAffinity</span><span class="token punctuation">:</span> ClientIP
</code></pre></div><p>If you want to specify time, as well, this is what needs to be added:</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code>  <span class="token key atrule">sessionAffinityConfig</span><span class="token punctuation">:</span>
    <span class="token key atrule">clientIP</span><span class="token punctuation">:</span>
      <span class="token key atrule">timeoutSeconds</span><span class="token punctuation">:</span> <span class="token number">10</span>
</code></pre></div><h2 id="liveness-readiness-probe"><a href="#liveness-readiness-probe" aria-hidden="true" class="header-anchor">#</a> Liveness &amp; Readiness Probe</h2> <p>Probes have a number of fields that you can use to more precisely control the behavior of liveness and readiness checks:</p> <ul><li><strong>initialDelaySeconds:</strong> Number of seconds after the container has started before liveness or readiness probes are initiated.</li> <li>periodSeconds: How often (in seconds) to perform the probe. Default to 10 seconds. Minimum value is 1.</li> <li><strong>timeoutSeconds:</strong> Number of seconds after which the probe times out. Defaults to 1 second. Minimum value is 1.</li> <li><strong>successThreshold:</strong> Minimum consecutive successes for the probe to be considered successful after having failed. Defaults to 1. Must be 1 for liveness. Minimum value is 1.</li> <li><strong>failureThreshold:</strong> When a Pod starts and the probe fails, Kubernetes will try failureThreshold times before giving up. Giving up in case of liveness probe means restarting the Pod. In case of readiness probe the Pod will be marked Unready. Defaults to 3. Minimum value is 1.</li></ul> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Pod
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">labels</span><span class="token punctuation">:</span>
    <span class="token key atrule">test</span><span class="token punctuation">:</span> liveness
  <span class="token key atrule">name</span><span class="token punctuation">:</span> liveness<span class="token punctuation">-</span>exec
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">containers</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">args</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> /bin/sh
    <span class="token punctuation">-</span> <span class="token punctuation">-</span>c
    <span class="token punctuation">-</span> echo ok <span class="token punctuation">&gt;</span> /tmp/health; sleep 10; rm <span class="token punctuation">-</span>rf /tmp/health; sleep 600
    <span class="token key atrule">image</span><span class="token punctuation">:</span> gcr.io/google_containers/busybox
    <span class="token key atrule">livenessProbe</span><span class="token punctuation">:</span>
      <span class="token key atrule">exec</span><span class="token punctuation">:</span>
        <span class="token key atrule">command</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> cat
        <span class="token punctuation">-</span> /tmp/health
      <span class="token key atrule">initialDelaySeconds</span><span class="token punctuation">:</span> <span class="token number">15</span>
      <span class="token key atrule">timeoutSeconds</span><span class="token punctuation">:</span> <span class="token number">1</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> liveness
</code></pre></div><h2 id="image-pull-policy"><a href="#image-pull-policy" aria-hidden="true" class="header-anchor">#</a> Image Pull Policy</h2> <p>The default pull policy is <code>IfNotPresent</code> which causes the Kubelet to skip pulling an image if it already exists. If you would like to always force a pull, you can do one of the following:</p> <ul><li>set the <code>imagePullPolicy</code> of the container to <code>Always</code></li> <li>omit the <code>imagePullPolicy</code> and use <code>:latest</code> as the tag for the image to use</li> <li>omit the <code>imagePullPolicy</code> and the tag for the image to use</li></ul> <h2 id="cpu-memory-units"><a href="#cpu-memory-units" aria-hidden="true" class="header-anchor">#</a> CPU &amp; Memory Units</h2> <p><strong>Meaning of CPU</strong></p> <p>Limits and requests for CPU resources are measured in cpu units. One cpu, in Kubernetes, is equivalent to:</p> <ul><li>1 AWS vCPU</li> <li>1 Azure vCore</li> <li>1 Hyperthread on a bare-metal Intel processor with Hyperthreading</li></ul> <table><thead><tr><th>CPU#</th> <th>PCT</th> <th>Requests/Limits (millicpu)</th></tr></thead> <tbody><tr><td>1vCPU</td> <td>100%</td> <td>cpu: 1</td></tr> <tr><td>1vCPU</td> <td>50%</td> <td>cpu: 500m</td></tr> <tr><td>1vCPU</td> <td>25%</td> <td>cpu: 250m</td></tr> <tr><td>2vCPU</td> <td>50%</td> <td>cpu: 1</td></tr> <tr><td>2vCPU</td> <td>25%</td> <td>cpu: 500m</td></tr> <tr><td>2vCPU</td> <td>10%</td> <td>cpu: 50m</td></tr> <tr><td>4vCPU</td> <td>24%</td> <td>cpu: 1</td></tr></tbody></table> <p><strong>Meaning of memory</strong></p> <p>Limits and requests for <code>memory</code> are measured in bytes.
You can use M(egabytes) or Mi(bibytes). These are equivalent:
<code>129M or 123Mi</code></p> <blockquote><p>1 Megabyte (MB) = (1000)^2 bytes = 1000000 bytes.<br>
1 Mebibyte (MiB) = (1024)^2 bytes = 1048576 bytes.</p></blockquote> <h2 id="resource-limits"><a href="#resource-limits" aria-hidden="true" class="header-anchor">#</a> Resource Limits</h2> <p>Specify Limit Range for a namespace:
<code>kubectl create -f memory-defaults.yaml --namespace=default-mem-example</code> <strong>memory-defaults.yaml</strong></p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> LimitRange
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> mem<span class="token punctuation">-</span>limit<span class="token punctuation">-</span>range
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">limits</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">default</span><span class="token punctuation">:</span>
      <span class="token key atrule">memory</span><span class="token punctuation">:</span> 512Mi
    <span class="token key atrule">defaultRequest</span><span class="token punctuation">:</span>
      <span class="token key atrule">memory</span><span class="token punctuation">:</span> 256Mi
    <span class="token key atrule">type</span><span class="token punctuation">:</span> Container
</code></pre></div><p>Resource Limits for a container</p> <div class="language-yaml extra-class"><div class="highlight-lines"><br><br><br><br><div class="highlighted"> </div><br><br><br><br><br></div><pre class="language-yaml"><code><span class="token key atrule">containers</span><span class="token punctuation">:</span>
<span class="token punctuation">-</span> <span class="token key atrule">image</span><span class="token punctuation">:</span> nginx
  <span class="token key atrule">imagePullPolicy</span><span class="token punctuation">:</span> Always
  <span class="token key atrule">name</span><span class="token punctuation">:</span> default<span class="token punctuation">-</span>mem<span class="token punctuation">-</span>demo<span class="token punctuation">-</span>ctr
  <span class="token key atrule">resources</span><span class="token punctuation">:</span>                      <span class="token comment"># Specify resources limits/requests</span>
    <span class="token key atrule">limits</span><span class="token punctuation">:</span>
      <span class="token key atrule">memory</span><span class="token punctuation">:</span> 512Mi               <span class="token comment"># 512 Mebibytes memory limit</span>
    <span class="token key atrule">requests</span><span class="token punctuation">:</span>
      <span class="token key atrule">memory</span><span class="token punctuation">:</span> 256Mi               <span class="token comment"># Application requests 256Mi from the cluster</span>
</code></pre></div><h2 id="taints-and-tolerations"><a href="#taints-and-tolerations" aria-hidden="true" class="header-anchor">#</a> Taints and Tolerations</h2> <p>You can think of a taint as a bad smell that is added to a node. Once a node is tainted pods that don’t declare a toleration for the taint won’t be scheduled to that node. Depending on how bad the smell is (the strength of the taint) the prohibition may be soft or hard, and running pods that don’t tolerate the taint may be evicted from the node.</p> <h3 id="taints-explained"><a href="#taints-explained" aria-hidden="true" class="header-anchor">#</a> Taints Explained</h3> <p>Nodes are tainted using kubectl:</p> <div class="language- extra-class"><pre class="language-text"><code>kubectl taint nodes nodename key=value:effect
</code></pre></div><p>A taint consists of a key, a value for the key, and an effect. The key and value can be anything and act just like key:value pairs act throughout kubernetes: something matches if it specifies the same key and value.</p> <p>The effect can be:</p> <ul><li><strong>PreferNoSchedule:</strong> Prefer not to schedule intolerant pods to the tainted node</li> <li><strong>NoSchedule:</strong> Prohibits scheduling intolerant pods to the tainted node</li> <li><strong>NoExecute:</strong> Prohibits and also evict intolerant pods that are already running there</li></ul> <p>For example let’s say that I have added a node to run elasticsearch, and I don’t want anything else running on that node:</p> <div class="language- extra-class"><pre class="language-text"><code>kubectl taint nodes es-node elasticsearch=false:NoExecute
</code></pre></div><p>Once the node is tainted we can see the taint when using kubectl to describe the node:</p> <div class="language- extra-class"><pre class="language-text"><code>$kubectl describe nodes es-node
Name:               es-node
...
Taints:             elasticsearch=false:NoExecute
</code></pre></div><h3 id="tolerations-explained"><a href="#tolerations-explained" aria-hidden="true" class="header-anchor">#</a> Tolerations Explained</h3> <p>A toleration is how a pod declares that it can stand the smell of a taint. Tolerations are a property of the <code>PodSpec</code> and a toleration for the taint above might look like this:</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">tolerations</span><span class="token punctuation">:</span>
<span class="token punctuation">-</span> <span class="token key atrule">key</span><span class="token punctuation">:</span> elasticsearch   <span class="token comment"># Key name</span>
  <span class="token key atrule">operator</span><span class="token punctuation">:</span> Equal      <span class="token comment"># Either Equal or Exists</span>
  <span class="token key atrule">value</span><span class="token punctuation">:</span> <span class="token boolean important">false         </span><span class="token comment"># Value</span>
  <span class="token key atrule">effect</span><span class="token punctuation">:</span> NoExecute    <span class="token comment"># Effect</span>
</code></pre></div><p>To tolerate a specific taint the <code>key name</code> should be set to the same name used for the taint’s key, “elasticsearch” in this example.</p> <p>The <code>operator</code> can be one of Equal or Exists. If set to Equal then the value is required and must match the key value on the taint. If set to Exists then the value should be omitted and the toleration will match any taint with the specified key name.</p> <ul><li><strong>Equal:</strong> The key/value/effect parameters must match. This is the default.</li> <li><strong>Exists:</strong> The key/effect parameters must match. You must leave a blank value parameter, which matches any.</li></ul> <p>If <code>effect</code> is provided it must be PreferredNoSchedule, NoSchedule or NoExecute and should match the <code>effect</code> on the taint. If <code>effect</code> is omitted then the toleration will match any taint with any <code>effect</code> as long as the key and value match.</p> <h3 id="examples"><a href="#examples" aria-hidden="true" class="header-anchor">#</a> Examples</h3> <p><code>Untaint</code> the master nodes and verify as below:</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ kubectl taint nodes --all node-role.kubernetes.io/master-
node <span class="token string">&quot;node1&quot;</span> untainted

$ kubectl describe nodes node1 <span class="token operator">|</span> <span class="token function">grep</span> -i taint
Taints:             <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>
</code></pre></div><p>Set <code>NoExecute</code> taint on node2:</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ kubectl taint nodes node2 node2<span class="token operator">=</span>DoNotSchedulePods:NoExecute
node <span class="token string">&quot;node2&quot;</span> tainted
<span class="token punctuation">[</span>node1 ~<span class="token punctuation">]</span>$ kubectl describe nodes node2 <span class="token operator">|</span> <span class="token function">grep</span> Taint
Taints:             node2<span class="token operator">=</span>DoNotSchedulePods:NoExecute
</code></pre></div><p><code>Untaint</code> the setting on node2</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ kubectl taint nodes node3 node3:NoSchedule-
node <span class="token string">&quot;node2&quot;</span> untainted

$ kubectl describe nodes node2 <span class="token operator">|</span> <span class="token function">grep</span> Taint
Taints:             <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>
</code></pre></div><div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># Basic Example</span>
kubectl taint nodes node1 key<span class="token operator">=</span>value:NoSchedule

<span class="token comment"># This will remove the node-role.kubernetes.io/master taint from any nodes that have it, including the master node, meaning that the scheduler will then be able to schedule pods everywhere.</span>
kubectl taint nodes --all node-role.kubernetes.io/master-

<span class="token comment"># Do not schedule pods on node3 with kye:value dedicated=experimental</span>
kubectl taint nodes node3 dedicated<span class="token operator">=</span>experimental:NoSchedule
</code></pre></div><p>Taint by label</p> <div class="language-bash extra-class"><pre class="language-bash"><code>kubectl taint node -l myLabel<span class="token operator">=</span>X dedicated<span class="token operator">=</span>foo:PreferNoSchedule
</code></pre></div><p>This Pod can be scheduled on a node that has the taint dedicated=experimental:NoSchedule:</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">tolerations</span><span class="token punctuation">:</span>
<span class="token punctuation">-</span> <span class="token key atrule">key</span><span class="token punctuation">:</span> dedicated       <span class="token comment"># Matches the taint's key</span>
  <span class="token key atrule">operator</span><span class="token punctuation">:</span> Equal      <span class="token comment"># Equal, which means the value key has to match</span>
  <span class="token key atrule">value</span><span class="token punctuation">:</span> experimental  <span class="token comment"># Must match the tain with &quot;Equal&quot; operator</span>
  <span class="token key atrule">effect</span><span class="token punctuation">:</span> NoSchedule   <span class="token comment"># If included must match taint</span>
</code></pre></div><h2 id="node-selector"><a href="#node-selector" aria-hidden="true" class="header-anchor">#</a> Node Selector</h2> <p><code>nodeSelector</code> is the simplest form of constraint. <code>nodeSelector</code> is a field of PodSpec. It specifies a map of key-value pairs. For the pod to be eligible to run on a node, the node must have each of the indicated key-value pairs as <code>labels</code> (it can have additional labels as well). The most common usage is one key-value pair.</p> <p><strong>Attach label to a node</strong></p> <div class="language- extra-class"><pre class="language-text"><code>kubectl label nodes kubernetes-node-1 disktype=ssd
</code></pre></div><p><strong>Add a nodeSelector field to your pod configuration</strong></p> <div class="language-yaml extra-class"><div class="highlight-lines"><br><br><br><br><br><br><br><br><br><br><br><div class="highlighted"> </div><br><br></div><pre class="language-yaml"><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Pod
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> nginx
  <span class="token key atrule">labels</span><span class="token punctuation">:</span>
    <span class="token key atrule">env</span><span class="token punctuation">:</span> test
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">containers</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> nginx
    <span class="token key atrule">image</span><span class="token punctuation">:</span> nginx
    <span class="token key atrule">imagePullPolicy</span><span class="token punctuation">:</span> IfNotPresent
  <span class="token key atrule">nodeSelector</span><span class="token punctuation">:</span>
    <span class="token key atrule">disktype</span><span class="token punctuation">:</span> ssd
</code></pre></div><p>When you then run <code>kubectl create -f pod-nginx.yaml</code>, the Pod will get scheduled on the node that you attached the label to.</p> <p><strong>Built-in node labels</strong></p> <ul><li>kubernetes.io/hostname</li> <li>failure-domain.beta.kubernetes.io/zone</li> <li>failure-domain.beta.kubernetes.io/region</li> <li>beta.kubernetes.io/instance-type</li> <li>beta.kubernetes.io/os</li> <li>beta.kubernetes.io/arch</li></ul></div> <div class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated: </span> <span class="time">11/2/2018, 10:26:10 PM</span></div></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/kubernetes/cheatsheet.html" class="prev">
          Cheatsheet
        </a></span> <span class="next"><a href="/kubernetes/objects_configs.html">
          Objects: Data-In
        </a>
        →
      </span></p></div> </div> <!----></div></div>
    <script src="/assets/js/app.ed8a5df2.js" defer></script><script src="/assets/js/20.457d13ca.js" defer></script>
  </body>
</html>
