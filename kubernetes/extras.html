<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Extras | Tadone Vuepress</title>
    <meta name="description" content="Tadone Vuepress">
    <link rel="icon" href="/logo.png">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <link rel="apple-touch-icon" href="/icons/apple-touch-icon-152x152.png">
  <link rel="mask-icon" href="/icons/safari-pinned-tab.svg" color="#3eaf7c">
  <meta name="msapplication-TileImage" content="/icons/msapplication-icon-144x144.png">
  <meta name="msapplication-TileColor" content="#000000">
    
    <link rel="preload" href="/assets/css/styles.617d1252.css" as="style"><link rel="preload" href="/assets/js/app.617d1252.js" as="script"><link rel="preload" href="/assets/js/18.c72ee485.js" as="script"><link rel="prefetch" href="/assets/css/1.styles.8129c0d7.css"><link rel="prefetch" href="/assets/css/2.styles.c5aa97a7.css"><link rel="prefetch" href="/assets/js/1.8129c0d7.js"><link rel="prefetch" href="/assets/js/10.87990c44.js"><link rel="prefetch" href="/assets/js/11.5958ff09.js"><link rel="prefetch" href="/assets/js/12.7b198ceb.js"><link rel="prefetch" href="/assets/js/13.f95562cc.js"><link rel="prefetch" href="/assets/js/14.e9d1e1b1.js"><link rel="prefetch" href="/assets/js/15.2778f12e.js"><link rel="prefetch" href="/assets/js/16.0f49bc38.js"><link rel="prefetch" href="/assets/js/17.3487865c.js"><link rel="prefetch" href="/assets/js/19.53117c99.js"><link rel="prefetch" href="/assets/js/2.c5aa97a7.js"><link rel="prefetch" href="/assets/js/20.e10cff6d.js"><link rel="prefetch" href="/assets/js/21.88768c3b.js"><link rel="prefetch" href="/assets/js/22.7da80cc2.js"><link rel="prefetch" href="/assets/js/23.08c220f1.js"><link rel="prefetch" href="/assets/js/24.982e4c28.js"><link rel="prefetch" href="/assets/js/25.4871135d.js"><link rel="prefetch" href="/assets/js/26.461e2960.js"><link rel="prefetch" href="/assets/js/27.d9b6a1b4.js"><link rel="prefetch" href="/assets/js/28.c9605504.js"><link rel="prefetch" href="/assets/js/29.c558d31c.js"><link rel="prefetch" href="/assets/js/3.7a7c2ada.js"><link rel="prefetch" href="/assets/js/30.303399e1.js"><link rel="prefetch" href="/assets/js/31.06cc4274.js"><link rel="prefetch" href="/assets/js/32.1ce7e320.js"><link rel="prefetch" href="/assets/js/33.e2469a9e.js"><link rel="prefetch" href="/assets/js/4.3273090a.js"><link rel="prefetch" href="/assets/js/5.64c754e9.js"><link rel="prefetch" href="/assets/js/6.9ba55a73.js"><link rel="prefetch" href="/assets/js/7.ccc80a46.js"><link rel="prefetch" href="/assets/js/8.bd6da320.js"><link rel="prefetch" href="/assets/js/9.ef3fb516.js">
    <link rel="stylesheet" href="/assets/css/1.styles.8129c0d7.css"><link rel="stylesheet" href="/assets/css/2.styles.c5aa97a7.css"><link rel="stylesheet" href="/assets/css/styles.617d1252.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Tadone Vuepress</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">Home</a></div><div class="nav-item"><a href="https://github.com/tadone" target="_blank" rel="noopener noreferrer" class="nav-link external">
  My GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">Home</a></div><div class="nav-item"><a href="https://github.com/tadone" target="_blank" rel="noopener noreferrer" class="nav-link external">
  My GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><div class="sidebar-group first"><p class="sidebar-heading"><span>Cloud</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/cloud/aws.html" class="sidebar-link">AWS</a></li><li><a href="/cloud/azure.html" class="sidebar-link">Azure</a></li></ul></div></li><li><div class="sidebar-group"><p class="sidebar-heading"><span>Code</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/code/git.html" class="sidebar-link">Git</a></li><li><a href="/code/bash.html" class="sidebar-link">Bash Scripting</a></li><li><a href="/code/python.html" class="sidebar-link">Python</a></li><li><a href="/code/python/list.html" class="sidebar-link">Python Lists</a></li><li><a href="/code/python/class.html" class="sidebar-link">Python Classes</a></li></ul></div></li><li><div class="sidebar-group"><p class="sidebar-heading"><span>DevOps</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/devops/cicd.html" class="sidebar-link">CI/CD</a></li><li><a href="/devops/docker.html" class="sidebar-link">Docker</a></li><li><a href="/devops/databases.html" class="sidebar-link">Database Technologies</a></li><li><a href="/devops/sql.html" class="sidebar-link">SQL Basics</a></li></ul></div></li><li><div class="sidebar-group"><p class="sidebar-heading open"><span>Kubernetes</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/kubernetes/overview.html" class="sidebar-link">Overview</a></li><li><a href="/kubernetes/kubectl.html" class="sidebar-link">KubeCtl</a></li><li><a href="/kubernetes/objects.html" class="sidebar-link">Objects</a></li><li><a href="/kubernetes/ingress.html" class="sidebar-link">Services &amp; Ingress</a></li><li><a href="/kubernetes/extras.html" class="active sidebar-link">Extras</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/kubernetes/extras.html#env-variables" class="sidebar-link">ENV Variables</a></li><li class="sidebar-sub-header"><a href="/kubernetes/extras.html#commands" class="sidebar-link">Commands</a></li><li class="sidebar-sub-header"><a href="/kubernetes/extras.html#session-affinity" class="sidebar-link">Session Affinity</a></li><li class="sidebar-sub-header"><a href="/kubernetes/extras.html#liveness-readiness-probe" class="sidebar-link">Liveness &amp; Readiness Probe</a></li><li class="sidebar-sub-header"><a href="/kubernetes/extras.html#debugging" class="sidebar-link">Debugging</a></li><li class="sidebar-sub-header"><a href="/kubernetes/extras.html#resource-limits" class="sidebar-link">Resource Limits</a></li></ul></li><li><a href="/kubernetes/troubleshooting.html" class="sidebar-link">Troubleshooting</a></li></ul></div></li><li><div class="sidebar-group"><p class="sidebar-heading"><span>Linux</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/linux/bash_shell.html" class="sidebar-link">Bash Shell</a></li><li><a href="/linux/linux_basics.html" class="sidebar-link">Fundementals</a></li><li><a href="/linux/linux_metrics.html" class="sidebar-link">Metrics</a></li><li><a href="/linux/linux_tools.html" class="sidebar-link">GNU Tools</a></li></ul></div></li><li><div class="sidebar-group"><p class="sidebar-heading"><span>Other</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/other/markdown.html" class="sidebar-link">Markdown Cheatsheet</a></li><li><a href="/other/yaml_json.html" class="sidebar-link">YAML &amp; JSON</a></li><li><a href="/other/setup.html" class="sidebar-link">System Setup</a></li></ul></div></li></ul> </div> <div class="page"> <div class="content"><h2 id="env-variables"><a href="#env-variables" aria-hidden="true" class="header-anchor">#</a> ENV Variables</h2> <p>Use environment variables to define arguments</p> <div class="language-bash extra-class"><pre class="language-bash"><code>env:
- name: MESSAGE
  value: <span class="token string">&quot;hello world&quot;</span>
command: <span class="token punctuation">[</span><span class="token string">&quot;/bin/echo&quot;</span><span class="token punctuation">]</span>
args: <span class="token punctuation">[</span><span class="token string">&quot;<span class="token variable"><span class="token variable">$(</span>MESSAGE<span class="token variable">)</span></span>&quot;</span><span class="token punctuation">]</span>
</code></pre></div><h2 id="commands"><a href="#commands" aria-hidden="true" class="header-anchor">#</a> Commands</h2> <p>Run a command in a shell</p> <div class="language-bash extra-class"><pre class="language-bash"><code>command: <span class="token punctuation">[</span><span class="token string">&quot;/bin/sh&quot;</span><span class="token punctuation">]</span>
args: <span class="token punctuation">[</span><span class="token string">&quot;-c&quot;</span>, <span class="token string">&quot;while true; do echo hello; sleep 10; done&quot;</span><span class="token punctuation">]</span>
</code></pre></div><p>Example that will <code>printenv</code> HOSTNAME and KUBERNETES_PORT</p> <div class="language-yaml extra-class"><div class="highlight-lines"><br><br><br><br><br><br><br><br><br><div class="highlighted"> </div><br><br><br><br></div><pre class="language-yaml"><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Pod
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> command<span class="token punctuation">-</span>demo
  <span class="token key atrule">labels</span><span class="token punctuation">:</span>
    <span class="token key atrule">purpose</span><span class="token punctuation">:</span> demonstrate<span class="token punctuation">-</span>command
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">containers</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> command<span class="token punctuation">-</span>demo<span class="token punctuation">-</span>container
    <span class="token key atrule">image</span><span class="token punctuation">:</span> debian
    <span class="token key atrule">command</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;printenv&quot;</span><span class="token punctuation">]</span>
    <span class="token key atrule">args</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;HOSTNAME&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;KUBERNETES_PORT&quot;</span><span class="token punctuation">]</span>
  <span class="token key atrule">restartPolicy</span><span class="token punctuation">:</span> OnFailure
</code></pre></div><h2 id="session-affinity"><a href="#session-affinity" aria-hidden="true" class="header-anchor">#</a> Session Affinity</h2> <p>Enable Session Affinity (a.k.a Sticky Session) to Kubernetes service</p> <p>This would be the yaml file of the service:</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">kind</span><span class="token punctuation">:</span> Service
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> my<span class="token punctuation">-</span>service
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">selector</span><span class="token punctuation">:</span>
    <span class="token key atrule">app</span><span class="token punctuation">:</span> my<span class="token punctuation">-</span>app
  <span class="token key atrule">ports</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> http
    <span class="token key atrule">protocol</span><span class="token punctuation">:</span> TCP
    <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">80</span>
    <span class="token key atrule">targetPort</span><span class="token punctuation">:</span> <span class="token number">80</span>
  <span class="token key atrule">sessionAffinity</span><span class="token punctuation">:</span> ClientIP
</code></pre></div><p>If you want to specify time, as well, this is what needs to be added:</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code>  <span class="token key atrule">sessionAffinityConfig</span><span class="token punctuation">:</span>
    <span class="token key atrule">clientIP</span><span class="token punctuation">:</span>
      <span class="token key atrule">timeoutSeconds</span><span class="token punctuation">:</span> <span class="token number">10</span>
</code></pre></div><h2 id="liveness-readiness-probe"><a href="#liveness-readiness-probe" aria-hidden="true" class="header-anchor">#</a> Liveness &amp; Readiness Probe</h2> <p>https://kubernetes.io/docs/tasks/configure-pod-container/configure-liveness-readiness-probes/
http://kubernetesbyexample.com/healthz/
https://kubernetes-v1-4.github.io/docs/user-guide/liveness/
https://github.com/arun-gupta/kubernetes-java-sample/blob/master/wildfly-pod-hc-http.yaml
http://kubernetesbyexample.com/healthz/</p> <p>Probes have a number of fields that you can use to more precisely control the behavior of liveness and readiness checks:</p> <ul><li>initialDelaySeconds: Number of seconds after the container has started before liveness or readiness probes are initiated.</li> <li>periodSeconds: How often (in seconds) to perform the probe. Default to 10 seconds. Minimum value is 1.</li> <li>timeoutSeconds: Number of seconds after which the probe times out. Defaults to 1 second. Minimum value is 1.</li> <li>successThreshold: Minimum consecutive successes for the probe to be considered successful after having failed. Defaults to 1. Must be 1 for liveness. Minimum value is 1.</li> <li>failureThreshold: When a Pod starts and the probe fails, Kubernetes will try failureThreshold times before giving up. Giving up in case of liveness probe means restarting the Pod. In case of readiness probe the Pod will be marked Unready. Defaults to 3. Minimum value is 1.</li></ul> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Pod
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">labels</span><span class="token punctuation">:</span>
    <span class="token key atrule">test</span><span class="token punctuation">:</span> liveness
  <span class="token key atrule">name</span><span class="token punctuation">:</span> liveness<span class="token punctuation">-</span>exec
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">containers</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">args</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> /bin/sh
    <span class="token punctuation">-</span> <span class="token punctuation">-</span>c
    <span class="token punctuation">-</span> echo ok <span class="token punctuation">&gt;</span> /tmp/health; sleep 10; rm <span class="token punctuation">-</span>rf /tmp/health; sleep 600
    <span class="token key atrule">image</span><span class="token punctuation">:</span> gcr.io/google_containers/busybox
    <span class="token key atrule">livenessProbe</span><span class="token punctuation">:</span>
      <span class="token key atrule">exec</span><span class="token punctuation">:</span>
        <span class="token key atrule">command</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> cat
        <span class="token punctuation">-</span> /tmp/health
      <span class="token key atrule">initialDelaySeconds</span><span class="token punctuation">:</span> <span class="token number">15</span>
      <span class="token key atrule">timeoutSeconds</span><span class="token punctuation">:</span> <span class="token number">1</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> liveness
</code></pre></div><h2 id="debugging"><a href="#debugging" aria-hidden="true" class="header-anchor">#</a> Debugging</h2> <h3 id="pod-crashloopbackoff-starting-then-crashing-then-starting-again-and-crashing-again"><a href="#pod-crashloopbackoff-starting-then-crashing-then-starting-again-and-crashing-again" aria-hidden="true" class="header-anchor">#</a> Pod CrashLoopBackOff: starting, then crashing, then starting again and crashing again</h3> <p>https://kubernetes.io/docs/tasks/debug-application-cluster/debug-init-containers/</p> <table><thead><tr><th>Status</th> <th>Meaning</th></tr></thead> <tbody><tr><td>Init:N/M</td> <td>The Pod has M Init Containers, and N have completed so far.</td></tr> <tr><td>Init:Error</td> <td>An Init Container has failed to execute.</td></tr> <tr><td>Init:CrashLoopBackOff</td> <td>An Init Container has failed repeatedly.</td></tr> <tr><td>Pending</td> <td>The Pod has not yet begun executing Init Containers.</td></tr> <tr><td>PodInitializing or Running</td> <td>The Pod has already finished executing Init Containers.</td></tr></tbody></table> <p>Note that the example above would work hitting ClusterIP type service directly (which is quite uncommon) or with Loadbalancer type service, but won't with an Ingress behind NodePort type service. This is because with an Ingress, the requests come from many, randomly chosen source IP addresses.</p> <h2 id="resource-limits"><a href="#resource-limits" aria-hidden="true" class="header-anchor">#</a> Resource Limits</h2> <p>Specify Limit Range for a namespace: <code>kubectl create -f memory-defaults.yaml --namespace=default-mem-example</code> <strong>memory-defaults.yaml</strong></p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> LimitRange
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> mem<span class="token punctuation">-</span>limit<span class="token punctuation">-</span>range
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">limits</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">default</span><span class="token punctuation">:</span>
      <span class="token key atrule">memory</span><span class="token punctuation">:</span> 512Mi
    <span class="token key atrule">defaultRequest</span><span class="token punctuation">:</span>
      <span class="token key atrule">memory</span><span class="token punctuation">:</span> 256Mi
    <span class="token key atrule">type</span><span class="token punctuation">:</span> Container
</code></pre></div><p>Resource Limits for a container</p> <div class="language-yaml extra-class"><div class="highlight-lines"><br><br><br><br><div class="highlighted"> </div><br><br><br><br><br></div><pre class="language-yaml"><code><span class="token key atrule">containers</span><span class="token punctuation">:</span>
<span class="token punctuation">-</span> <span class="token key atrule">image</span><span class="token punctuation">:</span> nginx
  <span class="token key atrule">imagePullPolicy</span><span class="token punctuation">:</span> Always
  <span class="token key atrule">name</span><span class="token punctuation">:</span> default<span class="token punctuation">-</span>mem<span class="token punctuation">-</span>demo<span class="token punctuation">-</span>ctr
  <span class="token key atrule">resources</span><span class="token punctuation">:</span>                      <span class="token comment"># Specify resources limits/requests</span>
    <span class="token key atrule">limits</span><span class="token punctuation">:</span>
      <span class="token key atrule">memory</span><span class="token punctuation">:</span> 512Mi               <span class="token comment"># 512 Mibibytes memory limit</span>
    <span class="token key atrule">requests</span><span class="token punctuation">:</span>
      <span class="token key atrule">memory</span><span class="token punctuation">:</span> 256Mi               <span class="token comment"># Application requests 256Mi from the cluster</span>
</code></pre></div></div> <div class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated: </span> <span class="time">10/30/2018, 3:20:39 PM</span></div></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/kubernetes/ingress.html" class="prev">
          Services &amp; Ingress
        </a></span> <span class="next"><a href="/kubernetes/troubleshooting.html">
          Troubleshooting
        </a>
        →
      </span></p></div> </div> <!----></div></div>
    <script src="/assets/js/18.c72ee485.js" defer></script><script src="/assets/js/app.617d1252.js" defer></script>
  </body>
</html>
