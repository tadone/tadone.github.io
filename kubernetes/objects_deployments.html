<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Objects: Deployments | Tadone Vuepress</title>
    <meta name="description" content="Tadone Vuepress">
    <link rel="icon" href="/logo.png">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <link rel="apple-touch-icon" href="/icons/apple-touch-icon-152x152.png">
  <link rel="mask-icon" href="/icons/safari-pinned-tab.svg" color="#3eaf7c">
  <meta name="msapplication-TileImage" content="/icons/msapplication-icon-144x144.png">
  <meta name="msapplication-TileColor" content="#000000">
    
    <link rel="preload" href="/assets/css/0.styles.d9b151b8.css" as="style"><link rel="preload" href="/assets/js/app.26e34d64.js" as="script"><link rel="preload" href="/assets/js/23.d068b859.js" as="script"><link rel="prefetch" href="/assets/js/10.89ae5d30.js"><link rel="prefetch" href="/assets/js/11.a75a28d9.js"><link rel="prefetch" href="/assets/js/12.97cb21a4.js"><link rel="prefetch" href="/assets/js/13.63fba130.js"><link rel="prefetch" href="/assets/js/14.3f23b28e.js"><link rel="prefetch" href="/assets/js/15.5c212fdd.js"><link rel="prefetch" href="/assets/js/16.6c4741f5.js"><link rel="prefetch" href="/assets/js/17.316138ad.js"><link rel="prefetch" href="/assets/js/18.712774dc.js"><link rel="prefetch" href="/assets/js/19.8cac1d03.js"><link rel="prefetch" href="/assets/js/2.fcb46994.js"><link rel="prefetch" href="/assets/js/20.c6295b52.js"><link rel="prefetch" href="/assets/js/21.4f5dd63e.js"><link rel="prefetch" href="/assets/js/22.b8c50060.js"><link rel="prefetch" href="/assets/js/24.00bae11a.js"><link rel="prefetch" href="/assets/js/25.7c783b56.js"><link rel="prefetch" href="/assets/js/26.fc534f83.js"><link rel="prefetch" href="/assets/js/27.f7fd5b9e.js"><link rel="prefetch" href="/assets/js/28.bebfaf48.js"><link rel="prefetch" href="/assets/js/29.1c3a4caf.js"><link rel="prefetch" href="/assets/js/3.fc9eb5c0.js"><link rel="prefetch" href="/assets/js/30.a1a7b142.js"><link rel="prefetch" href="/assets/js/31.074b511e.js"><link rel="prefetch" href="/assets/js/32.2f76116b.js"><link rel="prefetch" href="/assets/js/33.1e7f1c30.js"><link rel="prefetch" href="/assets/js/34.63fbe35b.js"><link rel="prefetch" href="/assets/js/35.47a5079a.js"><link rel="prefetch" href="/assets/js/36.a47a0a4e.js"><link rel="prefetch" href="/assets/js/37.3580690c.js"><link rel="prefetch" href="/assets/js/38.e86d7803.js"><link rel="prefetch" href="/assets/js/39.e89f71d4.js"><link rel="prefetch" href="/assets/js/4.069b95dd.js"><link rel="prefetch" href="/assets/js/40.889340c7.js"><link rel="prefetch" href="/assets/js/5.417dffac.js"><link rel="prefetch" href="/assets/js/6.f52330c7.js"><link rel="prefetch" href="/assets/js/7.e6b95d50.js"><link rel="prefetch" href="/assets/js/8.2b154f0d.js"><link rel="prefetch" href="/assets/js/9.cd3c1513.js">
    <link rel="stylesheet" href="/assets/css/0.styles.d9b151b8.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Tadone Vuepress</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">Home</a></div><div class="nav-item"><a href="https://github.com/tadone" target="_blank" rel="noopener noreferrer" class="nav-link external">
  My GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">Home</a></div><div class="nav-item"><a href="https://github.com/tadone" target="_blank" rel="noopener noreferrer" class="nav-link external">
  My GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><div class="sidebar-group first"><p class="sidebar-heading"><span>Cloud</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/cloud/aws.html" class="sidebar-link">AWS</a></li><li><a href="/cloud/azure.html" class="sidebar-link">Azure</a></li></ul></div></li><li><div class="sidebar-group"><p class="sidebar-heading"><span>Code</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/code/git.html" class="sidebar-link">Git</a></li><li><a href="/code/bash.html" class="sidebar-link">Bash Scripting</a></li><li><a href="/code/python.html" class="sidebar-link">Python</a></li><li><a href="/code/python/list.html" class="sidebar-link">Python Lists</a></li><li><a href="/code/python/class.html" class="sidebar-link">Python Classes</a></li></ul></div></li><li><div class="sidebar-group"><p class="sidebar-heading"><span>DevOps</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/devops/cicd.html" class="sidebar-link">CI/CD</a></li><li><a href="/devops/docker.html" class="sidebar-link">Docker</a></li><li><a href="/devops/databases.html" class="sidebar-link">Database Technologies</a></li><li><a href="/devops/sql.html" class="sidebar-link">SQL Basics</a></li></ul></div></li><li><div class="sidebar-group"><p class="sidebar-heading open"><span>Kubernetes</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/kubernetes/overview.html" class="sidebar-link">Overview</a></li><li><a href="/kubernetes/kubectl.html" class="sidebar-link">KubeCtl</a></li><li><a href="/kubernetes/cheatsheet.html" class="sidebar-link">Cheatsheet</a></li><li><a href="/kubernetes/configuration.html" class="sidebar-link">Configuration</a></li><li><a href="/kubernetes/objects_configs.html" class="sidebar-link">Objects: Data-In</a></li><li><a href="/kubernetes/objects_volumes.html" class="sidebar-link">Objects: Volumes</a></li><li><a href="/kubernetes/objects_deployments.html" class="active sidebar-link">Objects: Deployments</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/kubernetes/objects_deployments.html#pod" class="sidebar-link">Pod</a></li><li class="sidebar-sub-header"><a href="/kubernetes/objects_deployments.html#replication-controller" class="sidebar-link">Replication Controller</a></li><li class="sidebar-sub-header"><a href="/kubernetes/objects_deployments.html#deployment" class="sidebar-link">Deployment</a></li><li class="sidebar-sub-header"><a href="/kubernetes/objects_deployments.html#daemonset" class="sidebar-link">DaemonSet</a></li><li class="sidebar-sub-header"><a href="/kubernetes/objects_deployments.html#service" class="sidebar-link">Service</a></li><li class="sidebar-sub-header"><a href="/kubernetes/objects_deployments.html#statefulset" class="sidebar-link">StatefulSet</a></li><li class="sidebar-sub-header"><a href="/kubernetes/objects_deployments.html#namespace" class="sidebar-link">Namespace</a></li><li class="sidebar-sub-header"><a href="/kubernetes/objects_deployments.html#labels" class="sidebar-link">Labels</a></li><li class="sidebar-sub-header"><a href="/kubernetes/objects_deployments.html#annotations" class="sidebar-link">Annotations</a></li></ul></li><li><a href="/kubernetes/objects_services_ingress.html" class="sidebar-link">Objects: Services &amp; Ingress</a></li><li><a href="/kubernetes/cluster.html" class="sidebar-link">My Clusters</a></li><li><a href="/kubernetes/troubleshooting.html" class="sidebar-link">Troubleshooting</a></li></ul></div></li><li><div class="sidebar-group"><p class="sidebar-heading"><span>Linux</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/linux/bash_shell.html" class="sidebar-link">Bash Shell</a></li><li><a href="/linux/linux_basics.html" class="sidebar-link">Fundementals</a></li><li><a href="/linux/linux_metrics.html" class="sidebar-link">Metrics</a></li><li><a href="/linux/linux_tools.html" class="sidebar-link">GNU Tools</a></li></ul></div></li><li><div class="sidebar-group"><p class="sidebar-heading"><span>Other</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/other/markdown.html" class="sidebar-link">Markdown Cheatsheet</a></li><li><a href="/other/yaml_json.html" class="sidebar-link">YAML &amp; JSON</a></li><li><a href="/other/setup.html" class="sidebar-link">System Setup</a></li></ul></div></li></ul> </div> <div class="page"> <div class="content"><h1 id="deploying-and-running-containers"><a href="#deploying-and-running-containers" aria-hidden="true" class="header-anchor">#</a> Deploying and Running Containers</h1> <h2 id="pod"><a href="#pod" aria-hidden="true" class="header-anchor">#</a> Pod</h2> <p>A pod is a collection of containers (usually just single container) sharing a network and mount namespace and is the basic unit of deployment in Kubernetes. All containers in a pod are scheduled on the same node. Most of the time <code>deployment</code> should be used instead. Often, <code>init-containers</code> are part of the <code>pod</code>.</p> <p>Here is an example pod with 2 containers.</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Pod
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> twocontainers
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">containers</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> sise
    <span class="token key atrule">image</span><span class="token punctuation">:</span> mhausenblas/simpleservice<span class="token punctuation">:</span>0.5.0
    <span class="token key atrule">ports</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">containerPort</span><span class="token punctuation">:</span> <span class="token number">9876</span>
  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> shell
    <span class="token key atrule">image</span><span class="token punctuation">:</span> centos<span class="token punctuation">:</span><span class="token number">7</span>
    <span class="token key atrule">command</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token string">&quot;bin/bash&quot;</span>
      <span class="token punctuation">-</span> <span class="token string">&quot;-c&quot;</span>
      <span class="token punctuation">-</span> <span class="token string">&quot;sleep 10000&quot;</span>
</code></pre></div><h2 id="replication-controller"><a href="#replication-controller" aria-hidden="true" class="header-anchor">#</a> Replication Controller</h2> <p>A <code>replication controller</code> (RC) is a supervisor for long-running pods. An RC will launch a specified number of <code>pods</code> called <code>replicas</code> and makes sure that they keep running, for example when a node fails or something inside of a pod, that is, in one of its containers goes wrong.</p> <p><strong>Note that, going forward, the RCs are called <code>replica sets</code> (RS), supporting set-based selectors. The RS are already in use in the context of <code>deployments</code>.</strong></p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> ReplicationController
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> some<span class="token punctuation">-</span>namespace
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">replicas</span><span class="token punctuation">:</span> <span class="token number">1</span>
  <span class="token key atrule">selector</span><span class="token punctuation">:</span>
    <span class="token key atrule">app</span><span class="token punctuation">:</span> sise
  <span class="token key atrule">template</span><span class="token punctuation">:</span>
    <span class="token key atrule">metadata</span><span class="token punctuation">:</span>
      <span class="token key atrule">name</span><span class="token punctuation">:</span> somename
      <span class="token key atrule">labels</span><span class="token punctuation">:</span>
        <span class="token key atrule">app</span><span class="token punctuation">:</span> sise
    <span class="token key atrule">spec</span><span class="token punctuation">:</span>
      <span class="token key atrule">containers</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> sise
        <span class="token key atrule">image</span><span class="token punctuation">:</span> mhausenblas/simpleservice<span class="token punctuation">:</span>0.5.0
        <span class="token key atrule">ports</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">containerPort</span><span class="token punctuation">:</span> <span class="token number">9876</span>
</code></pre></div><h2 id="deployment"><a href="#deployment" aria-hidden="true" class="header-anchor">#</a> Deployment</h2> <p>A deployment is a supervisor for pods and replica sets, giving you fine-grained control over how and when a new pod version is rolled out as well as rolled back to a previous state.</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> apps/v1beta1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Deployment
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> myapp<span class="token punctuation">-</span>deploy        <span class="token comment"># Name of the deployment</span>
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">replicas</span><span class="token punctuation">:</span> <span class="token number">2               </span><span class="token comment"># Number of replicas (pods)</span>
  <span class="token key atrule">template</span><span class="token punctuation">:</span>
    <span class="token key atrule">metadata</span><span class="token punctuation">:</span>
      <span class="token key atrule">labels</span><span class="token punctuation">:</span>
        <span class="token key atrule">app</span><span class="token punctuation">:</span> MyApp          <span class="token comment"># Label all pods with &quot;app: MyApp&quot;</span>
    <span class="token key atrule">spec</span><span class="token punctuation">:</span>
      <span class="token key atrule">containers</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> myapp
        <span class="token key atrule">image</span><span class="token punctuation">:</span> mhausenblas/simpleservice<span class="token punctuation">:</span>0.5.0
        <span class="token key atrule">ports</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">containerPort</span><span class="token punctuation">:</span> <span class="token number">9876</span>
        <span class="token key atrule">env</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> SIMPLE_SERVICE_VERSION
          <span class="token key atrule">value</span><span class="token punctuation">:</span> <span class="token string">&quot;0.9&quot;</span>
</code></pre></div><h3 id="updating-a-deployment"><a href="#updating-a-deployment" aria-hidden="true" class="header-anchor">#</a> Updating a Deployment</h3> <p>Rollout is triggered if and only if the Deployment’s pod template is changed:</p> <ul><li>labels</li> <li>container image</li></ul> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># Edit deployment</span>
kubectl edit deployment.v1.apps/nginx-deployment

<span class="token comment"># Get rollout status</span>
kubectl rollout status deployment.v1.apps/nginx-deployment

<span class="token comment"># Describe the deployment</span>
kubectl describe deployment nginx-deployment
</code></pre></div><h3 id="rolling-back-a-deployment"><a href="#rolling-back-a-deployment" aria-hidden="true" class="header-anchor">#</a> Rolling Back a Deployment</h3> <p><code>Update</code> deployment. Append the <code>--record</code> flag to save the <code>kubectl</code> command that is making changes to the resource.</p> <div class="language- extra-class"><pre class="language-text"><code>$ kubectl set image deployment.v1.apps/nginx-deployment nginx=nginx:1.91 --record=true
deployment.apps/nginx-deployment image updated
</code></pre></div><p>Check <code>update/rollout</code> deployment (Can get stuck)</p> <div class="language- extra-class"><pre class="language-text"><code>$ kubectl rollout status deployment.v1.apps/nginx-deployment
Waiting for rollout to finish: 1 out of 3 new replicas have been updated...
</code></pre></div><p>Get rollout <code>history</code>. Use <code>--revision=2</code> for more details.</p> <div class="language- extra-class"><pre class="language-text"><code>kubectl rollout history deployment.v1.apps/nginx-deployment
</code></pre></div><p><code>Roll-back</code> to previous version</p> <div class="language- extra-class"><pre class="language-text"><code>$ kubectl rollout undo deployment.v1.apps/nginx-deployment
deployment.apps/nginx-deployment
</code></pre></div><p>Alternatively, you can <code>rollback</code> to a specific revision by specify that in <code>--to-revision</code></p> <div class="language- extra-class"><pre class="language-text"><code>$ kubectl rollout undo deployment.v1.apps/nginx-deployment --to-revision=2
deployment.apps/nginx-deployment
</code></pre></div><h3 id="pausing-and-resuming-a-deployment"><a href="#pausing-and-resuming-a-deployment" aria-hidden="true" class="header-anchor">#</a> Pausing and Resuming a Deployment</h3> <p><code>Pause</code> by running the following command:</p> <div class="language- extra-class"><pre class="language-text"><code>$ kubectl rollout pause deployment.v1.apps/nginx-deployment
deployment.apps/nginx-deployment paused
</code></pre></div><p>The initial state of the Deployment prior to pausing it will continue its function, but new updates to the Deployment will not have any effect as long as the Deployment is paused.</p> <p>Eventually, <code>resume</code> the Deployment and observe a new ReplicaSet coming up with all the new updates:</p> <div class="language- extra-class"><pre class="language-text"><code>$ kubectl rollout resume deployment.v1.apps/nginx-deployment
deployment.apps/nginx-deployment resumed
</code></pre></div><h3 id="scaling-a-deployment"><a href="#scaling-a-deployment" aria-hidden="true" class="header-anchor">#</a> Scaling a Deployment</h3> <p>You can <code>scale</code> a Deployment by using the following command:</p> <div class="language- extra-class"><pre class="language-text"><code>$ kubectl scale deployment.v1.apps/nginx-deployment --replicas=10
deployment.apps/nginx-deployment scaled
</code></pre></div><p>Assuming horizontal pod <code>autoscaling</code> is enabled in your cluster, you can setup an autoscaler for your Deployment and choose the <code>minimum</code> and <code>maximum</code> number of Pods you want to run based on the CPU utilization of your existing Pods.</p> <div class="language- extra-class"><pre class="language-text"><code>$ kubectl autoscale deployment.v1.apps/nginx-deployment --min=10 --max=15 --cpu-percent=80
deployment.apps/nginx-deployment scaled
</code></pre></div><h2 id="daemonset"><a href="#daemonset" aria-hidden="true" class="header-anchor">#</a> DaemonSet</h2> <p>A <code>DaemonSet</code> ensures that all (or some) <code>Nodes</code> run a copy of a <code>Pod</code>. As nodes are added to the cluster, <code>Pods</code> are added to them. As nodes are removed from the cluster, those <code>Pods</code> are garbage collected. Deleting a <code>DaemonSet</code> will clean up the <code>Pods</code> it created.</p> <p>Some typical uses of a DaemonSet are:</p> <ul><li>running a cluster storage daemon, such as <code>glusterd</code>, <code>ceph</code>, on each node.</li> <li>running a logs collection daemon on every node, such as <code>fluentd</code> or <code>logstash</code>.</li></ul> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> extensions/v1beta1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> DaemonSet
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> frontend
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">updateStrategy</span><span class="token punctuation">:</span> RollingUpdate     <span class="token comment"># Update strategy</span>
    <span class="token key atrule">maxUnavailable</span><span class="token punctuation">:</span> <span class="token number">1               </span><span class="token comment"># Max unavailable pods when updating</span>
    <span class="token key atrule">minReadySeconds</span><span class="token punctuation">:</span> <span class="token number">0</span>
  <span class="token key atrule">template</span><span class="token punctuation">:</span>
    <span class="token key atrule">metadata</span><span class="token punctuation">:</span>
      <span class="token key atrule">labels</span><span class="token punctuation">:</span>
        <span class="token key atrule">app</span><span class="token punctuation">:</span> frontend<span class="token punctuation">-</span>webserver     <span class="token comment"># All pods in DS will have label: &quot;app: frontend-webserver&quot;</span>
    <span class="token key atrule">spec</span><span class="token punctuation">:</span>
      <span class="token key atrule">nodeSelector</span><span class="token punctuation">:</span>
        <span class="token key atrule">app</span><span class="token punctuation">:</span> frontend<span class="token punctuation">-</span>node          <span class="token comment"># Selects which nodes will run this DS</span>
      <span class="token key atrule">containers</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> webserver
          <span class="token key atrule">image</span><span class="token punctuation">:</span> nginx
          <span class="token key atrule">ports</span><span class="token punctuation">:</span>
          <span class="token punctuation">-</span> <span class="token key atrule">containerPort</span><span class="token punctuation">:</span> <span class="token number">80</span>
</code></pre></div><p>Starting in Kubernetes 1.6, you will be able to do rolling updates with Kubernetes DaemonSets. You’ll have to set the <code>updateStrategy</code>.</p> <h2 id="service"><a href="#service" aria-hidden="true" class="header-anchor">#</a> Service</h2> <p>A Kubernetes Service is an abstraction which defines a logical set of Pods and a policy by which to access them - sometimes called a micro-service. The set of Pods targeted by a Service is (usually) determined by a <code>Label Selector</code></p> <p>This specification will create a new Service object named “<code>my-service</code>” which targets TCP port 9376 on any <code>Pod</code> with the &quot;<code>app=MyApp</code>&quot; label. This Service will also be assigned an IP address (<code>Cluster IP</code>).</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">kind</span><span class="token punctuation">:</span> Service
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> my<span class="token punctuation">-</span>service    <span class="token comment"># Name of the service</span>
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">selector</span><span class="token punctuation">:</span>
    <span class="token key atrule">app</span><span class="token punctuation">:</span> MyApp        <span class="token comment"># Service targets pods with &quot;app: MyApp&quot;</span>
  <span class="token key atrule">ports</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">protocol</span><span class="token punctuation">:</span> TCP
    <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">80</span>
    <span class="token key atrule">targetPort</span><span class="token punctuation">:</span> <span class="token number">9376</span>
</code></pre></div><p>Note that a <code>Service</code> can map an incoming port to any <code>targetPort</code>. By default the <code>targetPort</code> will be set to the same value as the <code>port</code> field. Perhaps more interesting is that <code>targetPort</code> can be a string, referring to the name of a port in the backend <code>Pods</code>. The actual port number assigned to that name can be different in each backend <code>Pod</code>. This offers a lot of flexibility for deploying and evolving your Services. For example, you can change the port number that pods expose in the next version of your backend software, without breaking clients.</p> <p><strong>More about services in &quot;Services &amp; Ingress&quot; section.</strong></p> <h2 id="statefulset"><a href="#statefulset" aria-hidden="true" class="header-anchor">#</a> StatefulSet</h2> <p>Deployment - You specify a <strong>PersistentVolumeClaim</strong> that is shared by all pod replicas. In other words, shared volume.</p> <p>The backing storage obviously must have <strong>ReadWriteMany</strong> or <strong>ReadOnlyMany</strong> accessMode if you have more than one replica pod.</p> <p>StatefulSet - You specify a <strong>volumeClaimTemplates</strong> so that each replica pod gets a unique <strong>PersistentVolumeClaim</strong> associated with it. In other words, no shared volume.</p> <p>Here, the backing storage can have <strong>ReadWriteOnce</strong> accessMode.</p> <p>StatefulSet is useful for running things in cluster e.g Hadoop cluster, MySQL cluster, where each node has its own storage.</p> <h1 id="metadata"><a href="#metadata" aria-hidden="true" class="header-anchor">#</a> Metadata</h1> <h2 id="namespace"><a href="#namespace" aria-hidden="true" class="header-anchor">#</a> Namespace</h2> <p><code>Namespaces</code> provide a scope of Kubernetes objects. You can think of it as a workspace you’re sharing with other users. Many objects such as pods and services are namespaced, while some (like nodes) are not. Can have access control or resource quotas.</p> <div class="language-yaml extra-class"><div class="highlight-lines"><br><br><br><div class="highlighted"> </div><br></div><pre class="language-yaml"><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Namespace
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> test    <span class="token comment"># Create namespace called &quot;test&quot;</span>
</code></pre></div><p>Later K8s resources can be deployed to that namespace using <code>metadata</code>. It will be hard coded so this pod will always deploy to that namespace.</p> <div class="language-yaml extra-class"><div class="highlight-lines"><br><br><br><br><div class="highlighted"> </div><br></div><pre class="language-yaml"><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Pod
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> podintest
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> test <span class="token comment"># This pod will be deployed in &quot;test&quot; namespace</span>
</code></pre></div><h2 id="labels"><a href="#labels" aria-hidden="true" class="header-anchor">#</a> Labels</h2> <p><code>Labels</code> are the mechanism you use to organize Kubernetes objects. A label is a key-value pair with certain restrictions concerning length and allowed values but without any pre-defined meaning. So you’re free to choose labels as you see fit, for example, to express environments such as ‘this pod is running in production’ or ownership, like ‘department X owns that pod’.</p> <div class="language-yaml extra-class"><div class="highlight-lines"><br><br><br><br><div class="highlighted"> </div><br><br><br><br><br><br><br><br><br><br></div><pre class="language-yaml"><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Pod
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> labelexother
  <span class="token key atrule">labels</span><span class="token punctuation">:</span>
    <span class="token key atrule">env</span><span class="token punctuation">:</span> production
    <span class="token key atrule">owner</span><span class="token punctuation">:</span> michael
    <span class="token key atrule">app</span><span class="token punctuation">:</span> MyApp
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">containers</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> sise
    <span class="token key atrule">image</span><span class="token punctuation">:</span> mhausenblas/simpleservice<span class="token punctuation">:</span>0.5.0
    <span class="token key atrule">ports</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">containerPort</span><span class="token punctuation">:</span> <span class="token number">9876</span>
</code></pre></div><h2 id="annotations"><a href="#annotations" aria-hidden="true" class="header-anchor">#</a> Annotations</h2> <p>Annotations is an unstructured key value map stored with a resource that may be set by external tools to store and retrieve arbitrary metadata. They are not &quot;queryable&quot; and should be preserved when modifying objects.</p> <div class="language-yaml extra-class"><div class="highlight-lines"><br><br><br><br><div class="highlighted"> </div><br><br><br><br><br><br><br><br><br><br><br></div><pre class="language-yaml"><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> extensions/v1beta1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Ingress
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> ghost<span class="token punctuation">-</span>ingress
  <span class="token key atrule">annotations</span><span class="token punctuation">:</span>
    <span class="token key atrule">kubernetes.io/ingress.class</span><span class="token punctuation">:</span> traefik  <span class="token comment"># Use annotation to define, which ingress controller to use (Traefik)</span>
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">rules</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">host</span><span class="token punctuation">:</span> <span class="token string">&quot;ghost.tadone.pw&quot;</span>
    <span class="token key atrule">http</span><span class="token punctuation">:</span>
      <span class="token key atrule">paths</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">path</span><span class="token punctuation">:</span> /
        <span class="token key atrule">backend</span><span class="token punctuation">:</span>
          <span class="token key atrule">serviceName</span><span class="token punctuation">:</span> ghost<span class="token punctuation">-</span>svc
          <span class="token key atrule">servicePort</span><span class="token punctuation">:</span> <span class="token number">80</span>
</code></pre></div></div> <div class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated: </span> <span class="time">1/9/2019, 12:22:28 AM</span></div></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/kubernetes/objects_volumes.html" class="prev">
          Objects: Volumes
        </a></span> <span class="next"><a href="/kubernetes/objects_services_ingress.html">
          Objects: Services &amp; Ingress
        </a>
        →
      </span></p></div> </div> <!----></div></div>
    <script src="/assets/js/app.26e34d64.js" defer></script><script src="/assets/js/23.d068b859.js" defer></script>
  </body>
</html>
