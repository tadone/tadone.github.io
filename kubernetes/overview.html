<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Overview | Tadone Vuepress</title>
    <meta name="description" content="Tadone Vuepress">
    <link rel="icon" href="/logo.png">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <link rel="apple-touch-icon" href="/icons/apple-touch-icon-152x152.png">
  <link rel="mask-icon" href="/icons/safari-pinned-tab.svg" color="#3eaf7c">
  <meta name="msapplication-TileImage" content="/icons/msapplication-icon-144x144.png">
  <meta name="msapplication-TileColor" content="#000000">
    
    <link rel="preload" href="/assets/css/styles.979a78ee.css" as="style"><link rel="preload" href="/assets/js/app.979a78ee.js" as="script"><link rel="preload" href="/assets/js/25.2e9bb212.js" as="script"><link rel="prefetch" href="/assets/css/1.styles.e3fe890c.css"><link rel="prefetch" href="/assets/css/2.styles.c5aa97a7.css"><link rel="prefetch" href="/assets/js/1.e3fe890c.js"><link rel="prefetch" href="/assets/js/10.87990c44.js"><link rel="prefetch" href="/assets/js/11.8a8d391f.js"><link rel="prefetch" href="/assets/js/12.d48b2b91.js"><link rel="prefetch" href="/assets/js/13.8cbad979.js"><link rel="prefetch" href="/assets/js/14.444da78a.js"><link rel="prefetch" href="/assets/js/15.c0c03324.js"><link rel="prefetch" href="/assets/js/16.79131c79.js"><link rel="prefetch" href="/assets/js/17.0342aa7f.js"><link rel="prefetch" href="/assets/js/18.658e28ec.js"><link rel="prefetch" href="/assets/js/19.56d77f24.js"><link rel="prefetch" href="/assets/js/2.c5aa97a7.js"><link rel="prefetch" href="/assets/js/20.12f407b2.js"><link rel="prefetch" href="/assets/js/21.c2eba41f.js"><link rel="prefetch" href="/assets/js/22.794a92a5.js"><link rel="prefetch" href="/assets/js/23.11e1a93c.js"><link rel="prefetch" href="/assets/js/24.532f4498.js"><link rel="prefetch" href="/assets/js/26.2e6e5328.js"><link rel="prefetch" href="/assets/js/27.b6f90799.js"><link rel="prefetch" href="/assets/js/28.61162adf.js"><link rel="prefetch" href="/assets/js/29.d7a05f22.js"><link rel="prefetch" href="/assets/js/3.f3e56684.js"><link rel="prefetch" href="/assets/js/30.f07e2f56.js"><link rel="prefetch" href="/assets/js/31.37ef77eb.js"><link rel="prefetch" href="/assets/js/32.e260d8e9.js"><link rel="prefetch" href="/assets/js/33.902d8fde.js"><link rel="prefetch" href="/assets/js/34.45b4b139.js"><link rel="prefetch" href="/assets/js/35.ed86e038.js"><link rel="prefetch" href="/assets/js/36.8edfcdb5.js"><link rel="prefetch" href="/assets/js/4.3273090a.js"><link rel="prefetch" href="/assets/js/5.836c6da9.js"><link rel="prefetch" href="/assets/js/6.40427144.js"><link rel="prefetch" href="/assets/js/7.96c5f51b.js"><link rel="prefetch" href="/assets/js/8.1577d1ec.js"><link rel="prefetch" href="/assets/js/9.81183b91.js">
    <link rel="stylesheet" href="/assets/css/1.styles.e3fe890c.css"><link rel="stylesheet" href="/assets/css/2.styles.c5aa97a7.css"><link rel="stylesheet" href="/assets/css/styles.979a78ee.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Tadone Vuepress</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">Home</a></div><div class="nav-item"><a href="https://github.com/tadone" target="_blank" rel="noopener noreferrer" class="nav-link external">
  My GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">Home</a></div><div class="nav-item"><a href="https://github.com/tadone" target="_blank" rel="noopener noreferrer" class="nav-link external">
  My GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><div class="sidebar-group first"><p class="sidebar-heading"><span>Cloud</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/cloud/aws.html" class="sidebar-link">AWS</a></li><li><a href="/cloud/azure.html" class="sidebar-link">Azure</a></li></ul></div></li><li><div class="sidebar-group"><p class="sidebar-heading"><span>Code</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/code/git.html" class="sidebar-link">Git</a></li><li><a href="/code/bash.html" class="sidebar-link">Bash Scripting</a></li><li><a href="/code/python.html" class="sidebar-link">Python</a></li><li><a href="/code/python/list.html" class="sidebar-link">Python Lists</a></li><li><a href="/code/python/class.html" class="sidebar-link">Python Classes</a></li></ul></div></li><li><div class="sidebar-group"><p class="sidebar-heading"><span>DevOps</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/devops/cicd.html" class="sidebar-link">CI/CD</a></li><li><a href="/devops/docker.html" class="sidebar-link">Docker</a></li><li><a href="/devops/databases.html" class="sidebar-link">Database Technologies</a></li><li><a href="/devops/sql.html" class="sidebar-link">SQL Basics</a></li></ul></div></li><li><div class="sidebar-group"><p class="sidebar-heading open"><span>Kubernetes</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/kubernetes/overview.html" class="active sidebar-link">Overview</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/kubernetes/overview.html#objects" class="sidebar-link">Objects</a></li><li class="sidebar-sub-header"><a href="/kubernetes/overview.html#networking" class="sidebar-link">Networking</a></li><li class="sidebar-sub-header"><a href="/kubernetes/overview.html#best-practices" class="sidebar-link">Best Practices</a></li></ul></li><li><a href="/kubernetes/kubectl.html" class="sidebar-link">KubeCtl</a></li><li><a href="/kubernetes/cheatsheet.html" class="sidebar-link">Cheatsheet</a></li><li><a href="/kubernetes/configuration.html" class="sidebar-link">Configuration</a></li><li><a href="/kubernetes/objects_configs.html" class="sidebar-link">Objects: Data-In</a></li><li><a href="/kubernetes/objects_volumes.html" class="sidebar-link">Objects: Volumes</a></li><li><a href="/kubernetes/objects_deployments.html" class="sidebar-link">Objects: Deployments</a></li><li><a href="/kubernetes/objects_services_ingress.html" class="sidebar-link">Objects: Services &amp; Ingress</a></li><li><a href="/kubernetes/cluster.html" class="sidebar-link">My Clusters</a></li><li><a href="/kubernetes/troubleshooting.html" class="sidebar-link">Troubleshooting</a></li></ul></div></li><li><div class="sidebar-group"><p class="sidebar-heading"><span>Linux</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/linux/bash_shell.html" class="sidebar-link">Bash Shell</a></li><li><a href="/linux/linux_basics.html" class="sidebar-link">Fundementals</a></li><li><a href="/linux/linux_metrics.html" class="sidebar-link">Metrics</a></li><li><a href="/linux/linux_tools.html" class="sidebar-link">GNU Tools</a></li></ul></div></li><li><div class="sidebar-group"><p class="sidebar-heading"><span>Other</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/other/markdown.html" class="sidebar-link">Markdown Cheatsheet</a></li><li><a href="/other/yaml_json.html" class="sidebar-link">YAML &amp; JSON</a></li><li><a href="/other/setup.html" class="sidebar-link">System Setup</a></li></ul></div></li></ul> </div> <div class="page"> <div class="content"><h1 id="overview"><a href="#overview" aria-hidden="true" class="header-anchor">#</a> Overview</h1> <hr> <p><strong>Kubernetes</strong> is a production-grade, open-source platform that orchestrates the placement (scheduling) and execution of application containers within and across computer clusters.</p> <p>A Kubernetes cluster consists of two types of resources:</p> <ul><li>The <strong>Master</strong> coordinates the cluster
<ul><li>The Kubernetes Master is a collection of three processes that run on a single node in your cluster, which is designated as the master node. Those processes are: <a href="https://kubernetes.io/docs/admin/kube-apiserver/" target="_blank" rel="noopener noreferrer">kube-apiserver<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>, <a href="https://kubernetes.io/docs/admin/kube-controller-manager/" target="_blank" rel="noopener noreferrer">kube-controller-manager<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> and <a href="https://kubernetes.io/docs/admin/kube-scheduler/" target="_blank" rel="noopener noreferrer">kube-scheduler<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>.</li></ul></li> <li><strong>Nodes</strong> are the workers that run applications
<ul><li>Each individual non-master node in your cluster runs two processes:
<ul><li><strong>kubelet</strong>, which communicates with the Kubernetes Master.</li> <li><strong>kube-proxy</strong>, a network proxy which reflects Kubernetes networking services on each node.</li></ul></li></ul></li></ul> <h2 id="objects"><a href="#objects" aria-hidden="true" class="header-anchor">#</a> Objects</h2> <p>The basic Kubernetes objects include:</p> <ul><li><strong>Cluster</strong>
The cluster is a collection of Nodes (computers) related to each other and work together.</li> <li><strong>Node</strong>
A node is the host that the container runs on.</li> <li><strong>Pod</strong>
A pod is a collection of containers, with shared storage and network, and a specification on how to run them. Each pod is allocated its own IP address. Containers within a pod share this IP address, port space and can find each other via localhost.</li> <li><strong>Label</strong>
A label in Kubernetes is a semantic tag that can be attached to Kubernetes objects to mark them as a part of a group. Labels are given as simple key-value pairs. Each unit can have more than one label, but each unit can only have one entry for each key.</li> <li><strong>Annotations</strong>
In general, annotations are a way of adding rich metadata to an object that is not helpful for selection purposes.</li> <li><strong>Service</strong>
It is an abstraction which defines a logical set of Pods and a policy by which to access them - sometimes called a micro-service. The set of Pods targeted by a Service is (usually) determined by a <code>Label Selector</code></li> <li><strong>Volume</strong>
Volumes allow data to be shared by all containers within a pod and remain available until the pod is terminated. This means that tightly coupled pods can easily share files without complex external mechanisms. Container failures within the pod will not affect access to the shared files. Once the pod is terminated, the shared volume is destroyed, so it is not a good solution for truly persistent data.</li> <li><strong>Persistent volumes</strong>
It's a mechanism for abstracting more robust storage that is not tied to the pod life cycle. Instead, they allow administrators to configure storage resources for the cluster that users can request and claim for the pods they are running. Once a pod is done with a persistent volume, the volume's reclamation policy determines whether the volume is kept around until manually deleted or removed along with the data immediately.</li> <li><strong>Namespace</strong>
Namespaces are a way to divide cluster resources between multiple users (via resource quota). Namespaces provide a scope for names. Names of resources need to be unique within a namespace, but not across namespaces. Namespaces are intended for use in environments with many users spread across multiple teams, or projects.
Kubernetes starts with three <strong>initial</strong> namespaces:
<ul><li><code>default</code> The default namespace for objects with no other namespace</li> <li><code>kube-system</code> The namespace for objects created by the Kubernetes system</li> <li><code>kube-public</code> This namespace is created automatically and is readable by all users (including those not authenticated). This namespace is mostly reserved for cluster usage, in case that some resources should be visible and readable publicly throughout the whole cluster. The public aspect of this namespace is only a convention, not a requirement.</li></ul></li> <li><strong>ConfigMap</strong>
ConfigMaps allow mounting configuration files into a Pod as an Environment variable or as a file system mount.</li> <li><strong>Secrets</strong>
Secrets are very similar to ConfigMaps, they are, by their name, “secret”.</li> <li><strong>ReplicaSet</strong>
A replicaset runs n number of pods, based on the provided template. Replicasets can (when instructed to) scale up or down the number of pods which are desired.</li> <li><strong>Deployment</strong>
Deployment describes a desired state in a Deployment object, and the Deployment controller changes the actual state to the desired state at a controlled rate. You can define Deployments to create new ReplicaSets, or to remove existing Deployments and adopt all their resources with new Deployments.</li> <li><strong>StatefulSet</strong>
Manages the deployment and scaling of a set of Pods , and provides guarantees about the ordering and uniqueness of these Pods.
Like a Deployment, a StatefulSet manages Pods that are based on an identical container spec. Unlike a Deployment, a StatefulSet maintains a sticky identity for each of their Pods. These pods are created from the same spec, but are not interchangeable: each has a persistent identifier that it maintains across any rescheduling.</li> <li><strong>DaemonSet</strong>
A Daemonset ensures that all Nodes run a specific Pod. This is useful for running something such as a logging agent like fluentd on all Nodes.
It is also possible to ignore certain Nodes by using Taints.</li> <li><strong>Ingress</strong>
In most circumstances, services and pods have IP addresses which are only accessible from within the Kubernetes cluster. With the services being isolated from internet traffic.
“An Ingress is a collection of rules that allow inbound connections to reach the cluster services.”
An ingress is just another Kubernetes resource, however, in most cases, it is required to have an <strong>Ingress Controller</strong> Such as Nginx or Træfik.</li> <li><strong>Job</strong>
A job creates one or more pods and ensures that a specified number of them successfully terminate. As pods successfully complete, the job tracks the successful completions. When a specified number of successful completions is reached, the job itself is complete. Deleting a Job will cleanup the pods it created.</li></ul> <h2 id="networking"><a href="#networking" aria-hidden="true" class="header-anchor">#</a> Networking</h2> <p>Each <code>Pod</code> is assigned a unique IP address. Every container in a Pod shares the network namespace, including the IP address and network ports. Containers inside a Pod can communicate with one another using <code>localhost</code>. When containers in a Pod communicate with entities outside the Pod, they must coordinate how they use the shared network resources (such as ports).</p> <h2 id="best-practices"><a href="#best-practices" aria-hidden="true" class="header-anchor">#</a> Best Practices</h2> <h3 id="namespaces-namespaces-namespaces"><a href="#namespaces-namespaces-namespaces" aria-hidden="true" class="header-anchor">#</a> Namespaces, Namespaces, Namespaces</h3> <ul><li>Namespaces let you run multiple identical stacks side by side</li> <li>Two namespaces (e.g. blue and green) can each have their own redis service</li> <li>Each of the two redis services has its own ClusterIP</li> <li>kube-dns creates two entries, mapping to these two ClusterIP addresses:</li> <li>redis.blue.svc.cluster.local and redis.green.svc.cluster.local</li> <li>Pods in the blue namespace get a search suffix of blue.svc.cluster.local</li> <li>As a result, resolving redis from a pod in the blue namespace yields  the “local” redis
<em>This does not provide isolation! That would be the job of network     policies.</em></li></ul> <p>As containers are to processes, Namespaces are to Kubernetes projects. Quite apart from the security boundary that Namespaces convey, they’re an excellent way to partition your work and they yield an excellent way to reset or delete it:
<code>kubectl delete namespace/$WORKING_PROJECT</code>
The only downside is that, when using the non-default namespace, you will need to specify your working namespace <code>--namespace=$WORKING_PROJECT</code> on kubectl commands.
<em>Best practice is to &quot;not&quot; reference namespace in Kubernetes YAML file so they can be reused for other</em></p> <h3 id="stateful-services-databases-etc"><a href="#stateful-services-databases-etc" aria-hidden="true" class="header-anchor">#</a> Stateful services (databases etc.)</h3> <ul><li>As a first step, it is wiser to keep stateful services outside of the cluster</li> <li>Exposing them to pods can be done with multiple solutions:</li> <li>ExternalName services (redis.blue.svc.cluster.local will be a CNAME record)</li> <li>ClusterIP services with explicit Endpoints (instead of letting Kubernetes generate the endpoints from a selector)</li> <li>Ambassador services (application-level proxies that can provide credentials injection and more)</li></ul> <h3 id="stateful-services-second-take"><a href="#stateful-services-second-take" aria-hidden="true" class="header-anchor">#</a> Stateful services (second take)</h3> <ul><li>If you really want to host stateful services on Kubernetes, you can look into:
<ul><li>volumes (to carry persistent data)</li> <li>storage plugins</li> <li>persistent volume claims (to ask for specific volume characteristics)
stateful sets (pods that are not ephemeral)</li></ul></li></ul> <h3 id="http-traffic-handling"><a href="#http-traffic-handling" aria-hidden="true" class="header-anchor">#</a> HTTP traffic handling</h3> <ul><li>Services are layer 4 constructs</li> <li>HTTP is a layer 7 protocol</li> <li>It is handled by ingresses (a different resource kind)</li> <li>Ingresses allow:
<ul><li>virtual host routing</li> <li>session stickiness</li> <li>URI mapping</li> <li>and much more!</li></ul></li></ul> <h3 id="use-json-and-jsonpath"><a href="#use-json-and-jsonpath" aria-hidden="true" class="header-anchor">#</a> Use JSON and JSONPATH</h3> <div class="language-bash extra-class"><pre class="language-bash"><code>kubectl get nodes --output<span class="token operator">=</span>json <span class="token operator">|</span> jq <span class="token string">'.items[].metadata.name'</span>
<span class="token comment"># JSON PATH</span>
kubectl get nodes --output<span class="token operator">=</span>jsonpath<span class="token operator">=</span><span class="token string">&quot;{.items[*]}&quot;</span>
kubectl get nodes --output<span class="token operator">=</span>jsonpath<span class="token operator">=</span><span class="token string">&quot;{.items[0]}&quot;</span>
kubectl get nodes --output<span class="token operator">=</span>jsonpath<span class="token operator">=</span><span class="token string">&quot;{.items[0].metadata.name}&quot;</span>
</code></pre></div><h3 id="logging-and-metrics"><a href="#logging-and-metrics" aria-hidden="true" class="header-anchor">#</a> Logging and metrics</h3> <ul><li>Logging is delegated to the container engine</li> <li>Metrics are typically handled with Prometheus</li></ul> <h3 id="managing-the-configuration-of-our-applications"><a href="#managing-the-configuration-of-our-applications" aria-hidden="true" class="header-anchor">#</a> Managing the configuration of our applications</h3> <ul><li>Two constructs are particularly useful: secrets and config maps</li> <li>They allow to expose arbitrary information to our containers</li> <li>Avoid storing configuration in container images (There are some exceptions to that rule, but it’s generally a Bad Idea)</li> <li>Never store sensitive information in container images (It’s the container equivalent of the password on a post-it note on your screen)</li></ul> <h3 id="cluster-federation"><a href="#cluster-federation" aria-hidden="true" class="header-anchor">#</a> Cluster federation</h3> <ul><li>Kubernetes master operation relies on etcd</li> <li>etcd uses the Raft protocol</li> <li>Raft recommends low latency between nodes</li> <li>What if our cluster spreads to multiple regions?</li> <li>Break it down in local clusters</li> <li>Regroup them in a cluster federation</li> <li>Synchronize resources across clusters</li> <li>Discover resources across clusters</li></ul></div> <div class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated: </span> <span class="time">11/2/2018, 10:26:10 PM</span></div></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/devops/sql.html" class="prev">
          SQL Basics
        </a></span> <span class="next"><a href="/kubernetes/kubectl.html">
          KubeCtl
        </a>
        →
      </span></p></div> </div> <!----></div></div>
    <script src="/assets/js/25.2e9bb212.js" defer></script><script src="/assets/js/app.979a78ee.js" defer></script>
  </body>
</html>
